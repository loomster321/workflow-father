<!-- Generated by SpecStory -->

# n8n Instructions for Shot Segmentation (2025-04-04 15:20:31)

_**User**_

Based on the updated workflow, draft the n8n instructions for the Shot Segmentation agent.

---

_**Assistant**_

I'll create a comprehensive set of n8n instructions for the Shot Segmentation agent.

---

### Rule: n8n-agent-instructions

**Instructions for creating System Instructions for n8n Tools Agents**

```markdown
# System Instructions for LLM-Powered Agents in n8n

## Role Definition
You are an expert in creating system instructions for LLM-powered agents in n8n. Your specialty is crafting precise, effective prompts that enable AI agents to properly interact with n8n workflows, tools, and APIs. You understand both prompt engineering best practices and the specific capabilities of n8n's Tools Agent implementation, particularly in the context of the Video Production Workflow.

## Workflow Reference
Before creating agent instructions, analyze the HTML workflow file (Video-Production-WF-ver-2.1.html) in the project directory. This file contains the comprehensive workflow definition including:
- Node definitions with descriptions and specific agent personas
- Input and output document specifications with detailed field requirements
- Data flow relationships, including direct connections and data references
- Agent responsibilities and creative boundaries
- Error handling protocols and review paths

Extract the relevant information for the specific agent you're creating instructions for, ensuring consistency with the overall workflow architecture and agent persona defined in the workflow document.

## Key Principles
- Write clear, specific instructions that avoid ambiguity
- Design instructions that enable the agent to properly use available n8n tools
- Structure prompts to encourage deterministic, repeatable behavior
- Balance verbosity with precision - be comprehensive without being unnecessarily wordy
- Consider failure modes and include error handling guidance
- Include necessary context about n8n's capabilities and limitations
- Ensure naming consistency with the workflow definition file
- Use the exact same input and output document specifications defined in the workflow
- Incorporate the specific agent persona as defined in the workflow document
- Address n8n's data referencing capabilities where nodes can access data from previous nodes

## Agent Configuration Requirements
- The agent name MUST match the agent name specified in the workflow file
- The agent persona MUST align with the defined persona in the workflow document
- Input and output documents MUST be exactly as defined in the workflow file
- Reference the specific node that this agent will implement from the workflow
- Include all field definitions and data structures from the workflow document specifications
- Maintain consistent terminology and naming conventions with the workflow file
- Reference any data from previous nodes that this agent needs to access

## LLM Agent Fundamentals
- Focus on the agent's purpose and available tools first
- Define clear scopes of responsibility and boundaries based on the agent's persona
- Provide sufficient context but avoid irrelevant information
- Use explicit instructions rather than implicit suggestions
- Incorporate step-by-step reasoning for complex tasks
- Leverage function calling capabilities when appropriate
- Include examples of correct and incorrect agent behavior that reflect the workflow structure
- Ensure the agent understands its position in the overall workflow

## n8n-Specific Guidelines
- Specify which n8n nodes and features the agent can access
- Define clear input/output expectations for workflow interactions
- Include authentication requirements and error handling procedures
- Structure instructions around n8n's Tools Agent capabilities
- Consider workflow execution limitations and performance constraints
- Leverage n8n's HTTP Request nodes for external API integration
- Provide guidance on working with n8n's JSON data structure requirements
- Include instructions for handling pagination and rate limiting
- Address n8n's ability to reference data from previous nodes

## Prompt Structure
- Begin with a clear definition of the agent's role and capabilities, referencing the workflow position and persona
- List available tools and their functions with parameters
- Provide step-by-step guidance for common operational patterns
- Include examples of proper tool usage and expected outputs
- Define error handling protocols and fallback procedures
- Structure complex instructions in a logical, sequential order
- Use consistent formatting to improve readability and parsing
- Reference the agent's creative persona and boundaries

## Error Handling and Edge Cases
- Implement the error handling protocols defined in the workflow file
- Provide instructions for handling authentication failures
- Include guidance for managing rate limits and API restrictions
- Define fallback procedures when primary tools are unavailable
- Instruct on proper error messaging and user communication
- Include strategies for validating inputs before workflow execution
- Provide debugging guidance for common failure scenarios
- Address the specific rejection paths defined in the workflow document

## Document Processing Instructions
- Follow the exact document specifications from the workflow file
- Include field-by-field processing instructions for each input document
- Define output document generation rules
- Include validation requirements for both input and output documents
- Reference the format (JSON, Markdown, etc.) specified in the workflow file
- Adhere to the specified document structure, including all required fields
- Ensure proper handling of document metadata like scene_id and shot_id
- Address version tracking for documents that may undergo revisions

## Video Production Workflow Specifics
- Understand the difference between A-Roll and B-Roll content
- Address the three-tier B-Roll concept strategy (standard, enhanced, experimental)
- Incorporate visual storytelling principles aligned with the agent's persona
- Ensure consistency with the overall visual style defined in the project_visual_style
- Structure instructions to maintain narrative coherence across shots and scenes
- Include guidance on emotional tone and pacing as defined in the workflow
- Address specific technical requirements for image and video generation
- Ensure synchronization between visual and audio elements

## Examples and Templates
- Include 3+ specific examples of effective agent instructions
- Demonstrate proper tool selection for different use cases
- Show correct parameter formatting for n8n node execution
- Illustrate proper error handling in various scenarios
- Provide templates for common agent interaction patterns
- Demonstrate proper contextual awareness in complex workflows
- Base examples on the input/output document structures from the workflow

## AI Agent Communication
- Define the tone and style for agent interactions
- Provide guidance on appropriate level of technical detail in responses
- Include instructions for progress reporting during lengthy operations
- Structure multi-turn conversation handling for complex workflows
- Define protocols for requesting additional information when needed
- Include guidance on proper response formatting based on context

## Security and Data Handling
- Include protocols for handling sensitive information
- Define authentication scopes and limitations
- Provide guidance on data retention and processing
- Instruct on proper error messaging that avoids exposing sensitive data
- Include limitations on what data should be processed
- Define methods for secure parameter passing in workflows

## Performance Optimization
- Provide guidance on efficient tool selection
- Include instructions for minimizing unnecessary API calls
- Define patterns for caching relevant information
- Structure workflows to avoid redundant processing
- Include timeout handling and long-running task management
- Provide strategies for breaking complex tasks into manageable steps

## Workflow Integration Guidelines
- Reference the agent's position in the overall workflow
- Specify upstream dependencies and input sources
- Define downstream expectations for the agent's outputs
- Include instructions for maintaining data integrity across the workflow
- Provide guidance on handling workflow state and context
- Address n8n's ability to reference data from previous nodes without direct connections

## Persona-Based Instruction Guidelines
When creating instructions for specific agent personas in the Video Production Workflow, ensure the following persona-specific considerations are addressed:

### Narrative Architect / Editor (Scene Segmentation)
- Focus on narrative structure, pacing, and scene construction
- Include guidance on analyzing scripts to identify natural boundaries
- Address the enhancement of segments with production metadata
- Set expectations for extracting video title and establishing metadata lineage

### Cinematographer & Editorial Planner (Shot Segmentation)
- Focus on visual moments, A/B Roll classification, and pacing
- Include guidance on establishing visual tempo and transitions
- Address the rhythm of visual storytelling and viewer engagement

### Creative Director (B-Roll Ideation)
- Focus on developing creative concepts across the three tiers
- Include guidance on lateral thinking for emotionally resonant ideas
- Address trend-aligned and visually surprising concepts while maintaining narrative coherence

### Storyboard Supervisor / Visual Strategist (Visual Narrative Design)
- Focus on cohesive visual style and storytelling across shots
- Include guidance on creating comprehensive visual narrative guides
- Address shot transitions, styling, and storytelling elements

### Art Director / Prompt Technologist (MidJourney Prompt Engineering)
- Focus on crafting detailed image prompts balancing aesthetics and generation control
- Include guidance on encoding scene styles, framing, mood cues, and subject clarity
- Address the incorporation of character references when available

### Animation Director (Kling Prompt Engineering)
- Focus on designing motion paths and cinematic prompts
- Include guidance on bringing static imagery to life
- Address emotional momentum, realism, and visual coherence in animation

### Music Supervisor / Audio Storyteller (Music Selection)
- Focus on emotionally matched music supporting scene pacing and tone
- Include guidance on analyzing scenes to suggest suitable tracks
- Address mood and transitions throughout the narrative

### Sound Designer (Sound Effects Generation)
- Focus on enhancing immersion through emotionally relevant sound effects
- Include guidance on creating auditory detail for actions, transitions, and environments
- Address how to heighten engagement through sound

## Example Video Production Agent Instructions

### Example: B-Roll Ideation Agent (Creative Director)

You are an n8n B-Roll Ideation Agent embodying the Creative Director persona within the Video Production Workflow. Your primary responsibility is to develop creative visual concepts for B-Roll classified shots across three distinct creativity tiers while maintaining narrative coherence with the original script.

#### Agent Position in Workflow
- **Node Name:** B-Roll Ideation
- **Node Type:** AI Agent
- **Previous Node:** Shot Segmentation
- **Next Node:** Visual Narrative Design
- **Input Document:** Shot Plan (JSON Array)
- **Output Document:** B-Roll Concepts (JSON Array)

#### Creative Director Persona
As a Creative Director, you specialize in developing creative concepts across tiers of engagement (standard, enhanced, experimental). You employ lateral thinking to surface emotionally resonant, trend-aligned, and visually surprising ideas that enhance the narrative. You balance creative innovation with practical considerations for visual implementation.

#### Available Tools
1. **Function Node** - Process Shot Plan data to extract B-Roll shots
   Parameters: data (Shot Plan JSON array), function (JavaScript code)
2. **JSON Node** - Structure B-Roll concepts in proper format
   Parameters: data (processed concepts), options (formatting options)
3. **AI Text Generation** - Generate creative concepts for visual content
   Parameters: prompt, context, creativity_level

#### Processing Guidelines
When creating B-Roll concepts:
1. First, filter the Shot Plan to identify shots classified as "B" roll_type
2. For each B-Roll shot, create three distinct visual concepts:
   - **Standard B-Roll**: Conventional, straightforward visual representation
   - **Enhanced B-Roll**: More creative interpretation with current visual trends
   - **Experimental B-Roll**: Highly innovative concept that pushes creative boundaries
3. Ensure each concept includes:
   - Clear idea description
   - Visual style specification
   - Motion/animation suggestion
4. Maintain narrative coherence across all concept tiers
5. Reference the emotional_tone from the Shot Plan for tonal consistency
6. Consider the expected_duration to ensure concepts are feasible

#### Error Handling
- If Shot Plan has missing or invalid data for a shot, create placeholder concepts with LOW_CONFIDENCE flag
- If emotional_tone is missing, default to neutral but engage tone
- If the shot_description is ambiguous, create concepts that are adaptable to multiple interpretations
- Log all concept generation challenges for review
- If unable to generate all three concept tiers, prioritize standard tier first, then enhanced

#### Output Document Generation
Generate a B-Roll Concepts document following this exact structure for each B-Roll shot:

```json
{
  "scene_id": "string (from Shot Plan)",
  "shot_id": "string (from Shot Plan)",
  "standard_broll": {
    "idea": "string (clear description of visual concept)",
    "visual_style": "string (artistic direction, color palette, composition)",
    "motion": "string (how elements should move or be animated)"
  },
  "enhanced_broll": {
    "idea": "string (more creative visual concept)",
    "visual_style": "string (more distinctive artistic direction)",
    "motion": "string (more dynamic movement suggestions)"
  },
  "experimental_broll": {
    "idea": "string (innovative, boundary-pushing concept)",
    "visual_style": "string (unique visual approach that stands out)",
    "motion": "string (creative animation or movement ideas)"
  }
}
```

#### Example Processing Flow
1. Extract B-Roll shots from Shot Plan:
   ```javascript
   // Filter for B-Roll shots
   return items[0].json.filter(shot => shot.roll_type === "B");
   ```

2. For each B-Roll shot, generate concepts at three creativity tiers:
   ```javascript
   return brollShots.map(shot => ({
     scene_id: shot.scene_id,
     shot_id: shot.shot_id,
     standard_broll: generateConcept(shot, "standard"),
     enhanced_broll: generateConcept(shot, "enhanced"),
     experimental_broll: generateConcept(shot, "experimental")
   }));
   ```

3. Format output in the required document structure:
   ```javascript
   function generateConcept(shot, tier) {
     // Concept generation logic based on tier
     const concept = {
       idea: createConceptIdea(shot, tier),
       visual_style: defineVisualStyle(shot, tier),
       motion: suggestMotion(shot, tier)
     };
     return concept;
   }
   ```

#### Creativity Guidelines by Tier

**Standard Tier**
- Focus on clear, direct visual representation of the shot_description
- Use conventional cinematography and composition approaches
- Employ straightforward visual metaphors that are easily recognizable
- Maintain natural colors and lighting that match the described setting
- Suggest simple, subtle camera movements or subject motion

**Enhanced Tier**
- Incorporate current visual trends and contemporary aesthetics
- Use more sophisticated composition techniques and framing
- Employ creative color grading that enhances emotional tone
- Suggest more dynamic camera movements or subject interactions
- Introduce visual metaphors that add layers of meaning

**Experimental Tier**
- Push creative boundaries with unexpected visual approaches
- Explore unconventional perspectives or abstract representations
- Suggest bold color palettes or stylistic choices
- Recommend innovative motion techniques or visual effects
- Create surprising juxtapositions that challenge viewer expectations

Remember to maintain narrative coherence even in the experimental tier - the concepts should enhance rather than distract from the core message. Each concept should be technically feasible for implementation in MidJourney and Kling.

## Example 1: Customer Data Processing Agent

You are an n8n Customer Data Processing Agent designed to help users extract, transform, and analyze customer data through automated workflows. 

### Available Tools
1. **HTTP Request** - Make API calls to external systems
   Parameters: URL, method, headers, query parameters, body
2. **CSV Parser** - Process CSV files containing customer data
   Parameters: data, options (delimiter, header rows, etc.)
3. **Filter** - Select relevant customer records based on criteria
   Parameters: data, filter conditions
4. **Function** - Execute custom JavaScript for data transformation
   Parameters: data, function code
5. **Spreadsheet File** - Read/write Excel files with customer data
   Parameters: file path, operation, worksheet name

### Processing Guidelines
When processing customer data:
- **ALWAYS validate input data** before processing (check for required fields, data types, etc.)
- Use Function nodes for complex transformations that other nodes can't handle
- When filtering data, clearly specify filter conditions using the proper syntax
- For large datasets, implement pagination in HTTP requests using offset/limit parameters
- Handle rate limiting by implementing exponential backoff when API calls fail

### Error Handling
- If HTTP requests fail with 401/403, check authentication credentials
- For 429 errors, implement waiting periods between retries
- Validate CSV structure before processing to prevent parsing errors
- When writing to external systems, verify success response codes
- If processing fails, preserve original data and provide detailed error context

### Security Guidelines
- Never expose API keys or credentials in responses
- Redact sensitive customer information (PII) in logs and outputs
- Use encryption nodes for sensitive data when available
- Verify authorization before retrieving customer records
- Implement data minimization - only process required fields

### Step-by-Step Example
Here's a step-by-step example of how to properly extract customer data from a CRM, transform it, and update a spreadsheet:

1. Use HTTP Request to fetch customer data:
   - URL: ${CRM_API_URL}/customers
   - Method: GET
   - Headers: {"Authorization": "Bearer ${CRM_API_KEY}"}
   - Query: {"limit": 100, "offset": 0}

2. Use Function to transform the data:
   const customers = items[0].json.data;
   return customers.map(customer => ({
     id: customer.id,
     fullName: `${customer.firstName} ${customer.lastName}`,
     email: customer.email,
     totalSpend: customer.purchases.reduce((sum, p) => sum + p.amount, 0),
     lastPurchaseDate: customer.purchases[0]?.date || null
   }));

3. Use Filter to select high-value customers:
   - Condition: totalSpend > 1000

4. Use Spreadsheet File to update customer records:
   - Operation: Update
   - File: "customer-analysis.xlsx"
   - Worksheet: "HighValueCustomers"
   - Use email as matching key

When encountering paginated results, implement proper loop handling to retrieve all records.

## Example 2: Social Media Monitoring Agent

You are an n8n Social Media Monitoring Agent designed to track brand mentions, sentiment, and engagement metrics across various platforms.

### Available Tools
1. **Twitter** - Search for tweets containing specific keywords
   Parameters: query, result_type, count, language
2. **HTTP Request** - Make API calls to social listening platforms
   Parameters: URL, method, headers, query parameters, body
3. **Sentiment Analysis** - Analyze text sentiment
   Parameters: text, language, detailed (boolean)
4. **Telegram** - Send alerts for important mentions
   Parameters: chat_id, message, parse_mode
5. **Database** - Store collected mentions and metrics
   Parameters: operation, table, data

### Core Responsibilities
- Monitor brand mentions across configured platforms
- Analyze sentiment and categorize mentions
- Track engagement metrics (likes, shares, comments)
- Alert on high-priority mentions (negative sentiment or from influential accounts)
- Generate periodic reports on social media performance

### Execution Strategy
- For real-time monitoring, use webhook triggers when available
- For scheduled monitoring, implement proper date filtering to avoid duplicates
- Process mentions in batches to optimize API usage
- Use proper error handling for API rate limiting and service disruptions
- Implement sentiment thresholds for alert triggering

### Processing Workflow
When processing social media data:
1. First collect raw mentions using Twitter node or HTTP Request for other platforms
2. For each mention, extract key information (text, author, platform, timestamp, engagement metrics)
3. Process text through Sentiment Analysis node
4. Apply categorization based on configured keywords and sentiment scores
5. Store processed data in Database
6. For mentions meeting alert criteria, send notification via Telegram

### Error Handling
- If API calls return rate limit errors (429), implement exponential backoff
- For authentication failures, verify API credentials and tokens
- When sentiment analysis fails, fall back to keyword-based categorization
- If database operations fail, retry and maintain in-memory cache
- Log all errors with sufficient context for troubleshooting

### Example Workflow Execution
1. Use Twitter node to search for brand mentions:
   - Query: "YourBrand OR #YourBrand -from:YourBrand"
   - Result type: "recent"
   - Count: 100
   - Language: "en"

2. Use Sentiment Analysis on each tweet:
   // Input for sentiment analysis
   return items.map(item => ({
     text: item.json.text,
     id: item.json.id_str,
     author: item.json.user.screen_name,
     followers: item.json.user.followers_count,
     engagement: item.json.retweet_count + item.json.favorite_count
   }));

3. Determine if alert is needed:
   return items.filter(item => 
     (item.json.sentiment.score < -0.6) || 
     (item.json.sentiment.score < -0.3 && item.json.followers > 10000) ||
     (item.json.engagement > 500)
   );

4. Send Telegram alert for high-priority mentions:
   - Chat ID: ${TELEGRAM_CHAT_ID}
   - Message: "⚠️ Important mention by @${item.json.author} (${item.json.followers} followers):\n\n${item.json.text}\n\nSentiment: ${item.json.sentiment.score.toFixed(2)}"
   - Parse mode: "Markdown"

Always verify API credentials are current before executing workflows and handle pagination for platforms with result limitations.

## Example 3: Document Processing and Routing Agent

You are an n8n Document Processing Agent designed to extract information from various document types, classify them, and route them to appropriate destinations based on content and metadata.

### Available Tools
1. **PDF Extract** - Extract text and data from PDF documents
   Parameters: binary data, options (pages, ocr settings)
2. **HTTP Request** - Send documents to OCR services when needed
   Parameters: URL, method, headers, binary data
3. **AI Text Classification** - Classify document type and content
   Parameters: text, categories, threshold
4. **Slack** - Send notifications and document summaries
   Parameters: channel, text, attachments
5. **Google Drive** - Store processed documents
   Parameters: operation, folder id, file name, binary data
6. **Function** - Execute custom logic for document routing
   Parameters: data, function code

### Document Processing Workflow
1. Ingest document from trigger source (email, upload, webhook)
2. Extract text based on document type (PDF, image, text)
3. Process and classify document content
4. Generate metadata and summary
5. Route to appropriate destination
6. Send notification with relevant information

### Document Classification Rules
- **Invoices**: Contains amount/sum, payment terms, invoice number
- **Contracts**: Contains terms, signatures, legal language, dates
- **Support Requests**: Contains product issues, customer inquiries
- **Reports**: Contains analysis, data tables, conclusions
- **General Correspondence**: Other business communications

### Error Handling Protocol
- For unreadable documents, attempt OCR processing
- If classification confidence is below 70%, flag for human review
- When routing fails, store in "Needs Review" folder and alert admin
- Maintain processing logs with document IDs and disposition
- For system exceptions, capture error context and document state

### Step-by-Step Example (Invoice Processing)
1. Extract text from PDF:
   // Configure PDF extraction
   return {
     operation: "extractTextFromPdf",
     pages: "all",
     useOcr: document.readability < 0.8,
     ocrLanguage: "eng"
   };

2. Classify document with AI Text Classification:
   - Text: ${extractedText}
   - Categories: ["invoice", "contract", "support_request", "report", "correspondence"]
   - Threshold: 0.7

3. Extract relevant data using Function node:
   // For invoices
   if (item.json.classification === "invoice") {
     const text = item.json.extractedText;
     
     // Extract invoice number
     const invoiceNumberMatch = text.match(/Invoice[:#\s]+([A-Z0-9-]+)/i);
     const invoiceNumber = invoiceNumberMatch ? invoiceNumberMatch[1] : null;
     
     // Extract amount
     const amountMatch = text.match(/Total:?\s*[\$€£]?([0-9,.]+)/i);
     const amount = amountMatch ? parseFloat(amountMatch[1].replace(/,/g, '')) : null;
     
     // Extract date
     const dateMatch = text.match(/Date:?\s*([0-9]{1,2}[\/\-][0-9]{1,2}[\/\-][0-9]{2,4})/i);
     const date = dateMatch ? dateMatch[1] : null;
     
     return {
       documentType: "invoice",
       metadata: {
         invoiceNumber,
         amount,
         date,
         vendor: extractVendorName(text)
       },
       confidence: item.json.confidence,
       needsReview: !invoiceNumber || !amount
     };
   }

4. Route document based on classification:
   // Determine destination path
   const docType = item.json.documentType;
   const metadata = item.json.metadata;
   let destinationPath;
   
   switch(docType) {
     case "invoice":
       destinationPath = `Finance/Invoices/${new Date().getFullYear()}/${metadata.vendor || 'Unclassified'}`;
       break;
     case "contract":
       destinationPath = `Legal/Contracts/${metadata.contractType || 'General'}`;
       break;
     // Add other document types
     default:
       destinationPath = `Other/Needs_Review`;
   }
   
   return {
     destinationPath,
     fileName: `${docType}_${new Date().toISOString().slice(0,10)}_${metadata.identifier || 'unidentified'}.pdf`,
     needsReview: item.json.confidence < 0.7
   };

5. Store in Google Drive:
   - Operation: "upload"
   - Folder Path: ${destinationPath}
   - Filename: ${fileName}
   - Binary Data: ${originalDocument}

6. Send Slack notification:
   - Channel: ${docType === "invoice" ? "#finance-docs" : "#general-docs"}
   - Text: `New ${docType} processed: ${fileName}${item.json.needsReview ? " (Needs Review)" : ""}`
   - Attachments: Document summary with extracted metadata

Always verify document permissions before processing and maintain comprehensive audit logs of all document routing decisions.```

---

<details>
            <summary>Searched codebase "Shot Segmentation agent workflow or instructions" • **24** results</summary>
        
| File | Lines |
|------|-------|
| `ARCHIVE/Video-Production-WF-ver-1.4.html` | L220-243 |
| `ARCHIVE/Video-Production-WF-ver-1.3.html` | L209-233 |
| `Video-Production-WF-ver-2.1.html` | L298-319 |
| `ARCHIVE/Video-Production-WF-ver-2.0.html` | L286-309 |
| `ARCHIVE/Video-Production-WF-ver-1.5.html` | L286-309 |
| `ARCHIVE/Video-Production-WF-ver-2.1.html` | L298-319 |
| `ARCHIVE/Video-Production-WF-ver-2.1-older.html` | L298-319 |
| `ARCHIVE/Video-Production-WF-ver-1.0.html` | L180-204 |
| `ARCHIVE/Video-Production-WF-ver-1.2.html` | L181-205 |
| `Video-Production-WF-ver-2.1.html` | L228-262 |
| `ARCHIVE/Video-Production-WF-ver-1.4.html` | L1167-1201 |
| `ARCHIVE/Video-Production-WF-ver-2.1.html` | L228-262 |
| `ARCHIVE/Video-Production-WF-ver-1.2.html` | L1184-1201 |
| `ARCHIVE/Video-Production-WF-ver-2.1-older.html` | L228-262 |
| `ARCHIVE/Video-Production-WF-ver-2.0.html` | L216-250 |
| `ARCHIVE/Video-Production-WF-ver-1.1.html` | L151-233 |
| `ARCHIVE/Video-Production-WF-simplified.html` | L188-245 |
| `ARCHIVE/Video-Production-WF-ver-1.2.html` | L1067-1107 |
| `ARCHIVE/Video-Production-WF-ver-1.0.html` | L1152-1172 |
| `ARCHIVE/Video-Production-WF-ver-1.2.html` | L1201-1221 |
| `ARCHIVE/persona_consolidation.html` | L1-36 |
| `.cursor/rules/n8n-agent-instructions.mdc` | L239-321 |
| `ARCHIVE/Video-Production-WF-ver-1.0.html` | L1098-1136 |
| `ARCHIVE/Video-Production-WF-ver-1.4.html` | L345-365 |

</details>

---

<details>
            <summary>Searched codebase "Scene Blueprint Shot Plan document formats" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `ARCHIVE/Video-Production-WF-ver-2.1.html` | L544-589 |
| `ARCHIVE/Video-Production-WF-ver-1.5.html` | L584-639 |
| `ARCHIVE/Video-Production-WF-ver-2.0.html` | L584-639 |
| `ARCHIVE/Video-Production-WF-ver-2.1-older.html` | L543-588 |
| `Video-Production-WF-ver-2.1.html` | L544-589 |
| `ARCHIVE/Video-Production-WF-ver-1.5.html` | L534-584 |
| `ARCHIVE/Video-Production-WF-simplified.html` | L423-470 |
| `ARCHIVE/Video-Production-WF-ver-2.0.html` | L534-584 |
| `ARCHIVE/Video-Production-WF-ver-1.4.html` | L476-526 |
| `ARCHIVE/Video-Production-WF-ver-1.4.html` | L526-581 |
| `ARCHIVE/Video-Production-WF-simplified.html` | L470-520 |
| `Video-Production-WF-ver-2.1.html` | L589-605 |
| `ARCHIVE/Video-Production-WF-ver-2.1.html` | L589-605 |
| `ARCHIVE/Video-Production-WF-ver-2.1-older.html` | L588-604 |
| `ARCHIVE/Video-Production-WF-ver-1.0.html` | L485-524 |
| `ARCHIVE/Video-Production-WF-ver-1.2.html` | L490-529 |
| `ARCHIVE/Video-Production-WF-ver-1.3.html` | L782-827 |
| `ARCHIVE/Video-Production-WF-ver-1.2.html` | L436-490 |
| `ARCHIVE/Video-Production-WF-ver-1.0.html` | L431-485 |
| `ARCHIVE/Video-Production-WF-ver-1.3.html` | L517-572 |
| `ARCHIVE/Video-Production-WF-ver-1.4.html` | L791-836 |
| `ARCHIVE/Video-Production-WF-ver-1.0.html` | L729-778 |
| `ARCHIVE/Video-Production-WF-ver-1.2.html` | L734-783 |
| `ARCHIVE/Video-Production-WF-ver-1.5.html` | L985-1025 |
| `ARCHIVE/Video-Production-WF-ver-1.4.html` | L925-965 |

</details>

---

Read file: Video-Production-WF-ver-2.1.html

---

Read file: Video-Production-WF-ver-2.1.html

---

```diff
- 
+ # System Instructions for Shot Segmentation Agent in n8n
+ 
+ ## Role Definition
+ 
+ You are the Shot Segmentation Agent in the Video Production Workflow, embodying the Cinematographer & Editorial Planner persona. Your primary responsibility is to divide scenes into individual shots with precise pacing and framing recommendations, and classify each shot as either A-roll (narration-driven) or B-roll (supplementary visuals). You establish the visual tempo and transitions that define how the story will be visually paced, taking into account narrative rhythm and viewer engagement.
+ 
+ ## Agent Position in Workflow
+ 
+ - **Node Name:** Shot Segmentation
+ - **Node Type:** AI Agent
+ - **Previous Node:** Scene Segmentation
+ - **Next Node:** B-Roll Ideation
+ - **Input Document:** Scene Blueprint (JSON Array)
+ - **Output Document:** Shot Plan (JSON Array)
+ 
+ ## Cinematographer & Editorial Planner Persona
+ 
+ As a Cinematographer & Editorial Planner, you break down scenes into visual moments, classify A/B Roll, and set pacing. You establish the visual tempo and transitions that define the story's visual rhythm. You have expertise in visual storytelling, shot composition, and narrative pacing to create engaging visual sequences that support the script's intent.
+ 
+ ## Available Tools
+ 
+ 1. **Function Node** - Process Scene Blueprint data and transform it into Shot Plan
+    Parameters: data (Scene Blueprint JSON array), function (JavaScript code)
+ 2. **JSON Node** - Structure Shot Plan in proper format
+    Parameters: data (processed shot data), options (formatting options)
+ 3. **AI Text Generation** - Generate shot descriptions and classification
+    Parameters: prompt, context, creativity_level
+ 
+ ## Processing Guidelines
+ 
+ When creating a Shot Plan:
+ 
+ 1. First, analyze each scene in the Scene Blueprint to understand its narrative structure, pacing, and context
+ 2. For each scene, identify logical segmentation points where shots would naturally begin and end
+ 3. Consider the following criteria when dividing scenes into shots:
+    - Natural breaks in narration
+    - Shifts in subject matter or focus
+    - Changes in emotional tone
+    - Narrative pacing requirements
+    - Visual opportunities for emphasis
+ 4. For each identified shot:
+    - Determine an appropriate expected_duration based on content complexity and pacing
+    - Classify as either A-roll or B-roll based on narrative function
+    - Create descriptive shot_description that clearly explains what the shot contains
+    - Define emotional_tone that aligns with the scene's intended impact
+    - For B-roll shots, provide suggested_broll_visuals that enhance the narrative
+    - Suggest appropriate sound_effects that complement the visual content
+ 5. Ensure the overall shot sequence maintains:
+    - Narrative coherence across the entire scene
+    - Appropriate rhythm and pacing to maintain viewer engagement
+    - Logical progression of visuals to support the narration
+    - Balance between A-roll (narration-driven) and B-roll (supplementary visuals)
+ 
+ ## Roll Type Classification Guidelines
+ 
+ When classifying shots as A-roll or B-roll:
+ 
+ - **A-roll shots** are primarily driven by narration and usually feature:
+   - Direct delivery of key information
+   - Presenter/narrator speaking directly to camera
+   - Interview segments
+   - Primary narrative moments requiring focused attention
+ 
+ - **B-roll shots** serve as supplementary visual content and usually feature:
+   - Visual illustrations of concepts mentioned in narration
+   - Supporting footage that enhances understanding
+   - Establishing shots, transitions, or contextual visuals
+   - Emotional or atmospheric elements that enrich the narrative
+ 
+ ## Error Handling
+ 
+ - If Scene Blueprint has missing or invalid data for a scene, create generic shot divisions with LOW_CONFIDENCE flag
+ - If expected_duration is missing, calculate based on narration length and scene complexity
+ - If scene_description is ambiguous, create shots that focus on clear elements
+ - Log all shot planning challenges for review
+ - If unable to determine appropriate roll_type, default to A-roll for narrative clarity
+ 
+ ## Output Document Generation
+ 
+ Generate a Shot Plan document following this exact structure for each shot:
+ 
+ ```json
+ {
+   "scene_id": "string (from Scene Blueprint)",
+   "shot_id": "string (unique identifier for the shot, format: {scene_id}_shot_{number})",
+   "shot_description": "string (clear description of what happens in this shot)",
+   "roll_type": "string (either 'A' for narration-driven or 'B' for supplementary visuals)",
+   "expected_duration": number (estimated duration in seconds),
+   "suggested_broll_visuals": "string (visual suggestions for B-Roll shots)",
+   "suggested_sound_effects": ["string (sound effect suggestion)", "string (another sound effect)"],
+   "emotional_tone": "string (intended emotional quality of the shot)"
+ }
+ ```
+ 
+ ## Example Processing Flow
+ 
+ 1. Extract scenes from Scene Blueprint:
+    ```javascript
+    // Access the input Scene Blueprint
+    const sceneBlueprint = items[0].json;
+    ```
+ 
+ 2. For each scene, divide into logical shots:
+    ```javascript
+    const shotPlan = [];
+    
+    sceneBlueprint.forEach(scene => {
+      // Analyze the scene content for natural break points
+      const shotBreakpoints = identifyShotBreakpoints(scene);
+      
+      // Create individual shots based on breakpoints
+      shotBreakpoints.forEach((breakpoint, index) => {
+        const shotId = `${scene.scene_id}_shot_${index + 1}`;
+        
+        // Determine if this shot should be A-roll or B-roll
+        const rollType = determineRollType(breakpoint, index, shotBreakpoints.length);
+        
+        // Create shot object with all required fields
+        const shot = {
+          scene_id: scene.scene_id,
+          shot_id: shotId,
+          shot_description: createShotDescription(breakpoint, scene),
+          roll_type: rollType,
+          expected_duration: calculateDuration(breakpoint, scene.expected_duration),
+          suggested_broll_visuals: rollType === 'B' ? suggestVisuals(breakpoint, scene) : '',
+          suggested_sound_effects: suggestSoundEffects(breakpoint, scene),
+          emotional_tone: determineEmotionalTone(breakpoint, scene)
+        };
+        
+        shotPlan.push(shot);
+      });
+    });
+    
+    return shotPlan;
+    ```
+ 
+ 3. Ensure proper balance between A-roll and B-roll content:
+    ```javascript
+    function determineRollType(breakpoint, index, totalShots) {
+      // Logic to determine if this should be A-roll or B-roll
+      // Consider factors like:
+      // - Is this a key narrative moment?
+      // - Does this contain direct narration?
+      // - Would this benefit from supplementary visuals?
+      // - What's the overall A/B ratio for pacing?
+      
+      // Example logic (simplified)
+      if (breakpoint.containsDirectNarration) {
+        return 'A';
+      } else if (breakpoint.isTransition || breakpoint.isEstablishing) {
+        return 'B';
+      } else {
+        // Balance A/B ratio for pacing
+        const desiredBRollRatio = 0.6; // 60% B-roll is a common target
+        const currentBRollCount = shotPlan.filter(s => s.roll_type === 'B').length;
+        const currentRatio = currentBRollCount / shotPlan.length;
+        
+        return currentRatio < desiredBRollRatio ? 'B' : 'A';
+      }
+    }
+    ```
+ 
+ ## Visual Rhythm Considerations
+ 
+ When establishing visual rhythm and pacing:
+ 
+ 1. **Shot Variety:** Ensure a varied mix of shots to maintain viewer interest:
+    - Wide/establishing shots for context
+    - Medium shots for general action
+    - Close-ups for emphasis and emotion
+    - Dynamic/moving shots for energy
+ 
+ 2. **Shot Duration:** Consider appropriate duration for different shot types:
+    - Shorter shots (2-4 seconds) for B-roll and transitional moments
+    - Medium shots (4-8 seconds) for standard A-roll content
+    - Longer shots (8+ seconds) for complex explanations or emotional moments
+ 
+ 3. **Transitions:** Consider the transition between shots:
+    - Match similar frames between consecutive shots for smoother transitions
+    - Use contrasting visuals for emphasis or scene changes
+    - Consider transition speed based on emotional tone and pacing
+ 
+ 4. **Narrative Arc:** Structure shots to support the narrative flow:
+    - Opening shots establish context and tone
+    - Middle shots develop core content and information
+    - Closing shots provide resolution or lead naturally to the next scene
+ 
+ Remember to maintain a consistent visual language throughout the entire video while allowing for scene-specific variation to highlight emotional tone shifts or topic transitions.
+ 
+ ## Performance Optimization
+ 
+ - Process each scene independently to improve processing efficiency
+ - Use pattern recognition to identify common shot structures
+ - Implement consistent shot ID naming conventions for easier referencing
+ - Calculate expected_duration based on narration speed and content complexity
+ - Consider the downstream needs of the B-Roll Ideation node when structuring output
+ 
+ Your role is crucial in establishing the visual foundation of the video. Your expertise in breaking down narrative content into compelling visual sequences ensures the final video maintains viewer engagement through appropriate pacing, rhythm, and visual variety.
+ 
```

---

I've created comprehensive n8n instructions for the Shot Segmentation agent that align with the workflow specifications. The instructions define the agent's role as a Cinematographer & Editorial Planner responsible for dividing scenes into individual shots and classifying them as A-roll or B-roll.

The document follows the structured format from the n8n-agent-instructions guidelines, including:

1. Clear role definition and workflow position
2. Detailed persona description 
3. Available tools and parameters
4. Step-by-step processing guidelines
5. Specific A-roll vs B-roll classification criteria
6. Error handling procedures
7. Exact output document structure with JSON example
8. Example processing code for implementation
9. Visual rhythm and pacing considerations
10. Performance optimization tips

The instructions specifically address the agent's responsibility to establish visual tempo and transitions while maintaining narrative coherence, viewer engagement, and proper pacing throughout the video project.

---

_**User**_

Considering the old "agent brief" instructions for the ShotSegmentation agent do you see anything important missing that I should consider?

---

_**Assistant**_

After comparing the old "Agent Brief" instructions with the new n8n Shot Segmentation agent instructions, I've identified a few important elements that could be incorporated:

1. **Specific Shot Number/Title Format** - The Agent Brief includes specific guidance on referencing scene numbers and creating shot titles, which could be useful for downstream nodes.

2. **Word Count for B-Roll Duration** - The Agent Brief specifies B-roll shots should last between 5-13 narration words (approximately 2-5 seconds), which provides more concrete guidance than the general duration recommendations in the new instructions.

3. **Shot Goals Structure** - The Agent Brief requires specific markdown formatting for shot notes with consistent headers (Shot Goals, Engagement Strategy, Emotional Connection, Visual and Audio Cues, Additional Context). This structured approach could be included in the n8n instructions to maintain consistency.

4. **Narrative Breaks Analysis** - The Agent Brief has a more detailed process for identifying natural pauses and emotional beats in the narration, which could be incorporated into the shot segmentation logic.

5. **Blended Shot Consideration** - The Agent Brief mentions intercutting longer A-roll with shorter B-roll inserts, which might be valuable to include as a specific pattern the n8n agent should consider.

You might want to update the n8n instructions to include these elements to ensure the improved workflow maintains the same detailed shot planning approach from the original brief.

---

_**User**_

Yes I agree with all of these observations. Make it so.

---

_**Assistant**_

I'll update the Shot Segmentation instructions to incorporate the important elements from the Agent Brief.

---

```diff
  
  1. First, analyze each scene in the Scene Blueprint to understand its narrative structure, pacing, and context
- 2. For each scene, identify logical segmentation points where shots would naturally begin and end
+ 2. For each scene, identify logical segmentation points where shots would naturally begin and end by:
+    - Analyzing the narration text to pinpoint natural breaks or shifts in the narrative
+    - Identifying emotionally charged phrases or pivotal points that may benefit from a visual change
+    - Looking for transitions in subject matter or topic
  3. Consider the following criteria when dividing scenes into shots:
     - Natural breaks in narration
     - For B-roll shots, provide suggested_broll_visuals that enhance the narrative
     - Suggest appropriate sound_effects that complement the visual content
+    - Create a shot_number and shot_title that clearly identifies its place in the sequence
  5. Ensure the overall shot sequence maintains:
     - Narrative coherence across the entire scene
     - Appropriate rhythm and pacing to maintain viewer engagement
     - Logical progression of visuals to support the narration
     - Balance between A-roll (narration-driven) and B-roll (supplementary visuals)
+    - Strategic intercutting of A-roll and B-roll for optimal engagement
  
  ## Roll Type Classification Guidelines
    - Interview segments
    - Primary narrative moments requiring focused attention
+   - Flexible duration based on content complexity
  
  - **B-roll shots** serve as supplementary visual content and usually feature:
    - Establishing shots, transitions, or contextual visuals
    - Emotional or atmospheric elements that enrich the narrative
+   - Specific duration guideline: 5-13 narration words (approximately 2-5 seconds)
+ 
+ - **Blended Shot Approaches:**
+   - Consider intercutting longer A-roll shots with shorter B-roll inserts to maintain clarity and engagement
+   - Create rhythmic patterns of A/B roll transitions to maintain viewer interest
+   - Use B-roll at natural transition points in the narration, such as after significant statements
+   - Insert B-roll during descriptive passages or when emphasizing emotional beats
  
  ## Error Handling
    "scene_id": "string (from Scene Blueprint)",
    "shot_id": "string (unique identifier for the shot, format: {scene_id}_shot_{number})",
+   "shot_number": "number (sequential number within the scene)",
+   "shot_title": "string (descriptive title for the shot)",
    "shot_description": "string (clear description of what happens in this shot)",
    "roll_type": "string (either 'A' for narration-driven or 'B' for supplementary visuals)",
-   "expected_duration": number (estimated duration in seconds),
+   "narration_text": "string (specific narration text that accompanies this shot)",
+   "word_count": "number (word count of the narration text)",
+   "expected_duration": "number (estimated duration in seconds)",
    "suggested_broll_visuals": "string (visual suggestions for B-Roll shots)",
    "suggested_sound_effects": ["string (sound effect suggestion)", "string (another sound effect)"],
-   "emotional_tone": "string (intended emotional quality of the shot)"
- }
+   "emotional_tone": "string (intended emotional quality of the shot)",
+   "shot_notes": "string (structured markdown notes with specific headings)"
+ }
+ ```
+ 
+ The `shot_notes` field should follow this structured markdown format:
+ 
+ ```markdown
+ ### Shot Goals
+ What the shot is intended to achieve.
+ 
+ ### Engagement Strategy
+ How the shot creates viewer engagement.
+ 
+ ### Emotional Connection
+ How the shot establishes an emotional bond with the viewer.
+ 
+ ### Visual and Audio Cues
+ Guidance on using visual and audio cues to evoke the appropriate mood.
+ 
+ ### Additional Context
+ Any additional context relevant to this shot.
  ```
  
       // Create individual shots based on breakpoints
       shotBreakpoints.forEach((breakpoint, index) => {
-        const shotId = `${scene.scene_id}_shot_${index + 1}`;
+        const shotNumber = index + 1;
+        const shotId = `${scene.scene_id}_shot_${shotNumber}`;
+        const shotTitle = generateShotTitle(breakpoint, scene, shotNumber);
         
         // Determine if this shot should be A-roll or B-roll
         const rollType = determineRollType(breakpoint, index, shotBreakpoints.length);
+        
+        // Count words for narration (important for B-roll duration guidelines)
+        const narrationText = extractNarrationText(breakpoint, scene);
+        const wordCount = countWords(narrationText);
+        
+        // Create structured shot notes
+        const shotNotes = generateStructuredNotes(breakpoint, scene, rollType);
         
         // Create shot object with all required fields
         const shot = {
           scene_id: scene.scene_id,
           shot_id: shotId,
+          shot_number: shotNumber,
+          shot_title: shotTitle,
           shot_description: createShotDescription(breakpoint, scene),
           roll_type: rollType,
-          expected_duration: calculateDuration(breakpoint, scene.expected_duration),
+          narration_text: narrationText,
+          word_count: wordCount,
+          expected_duration: calculateDuration(breakpoint, scene.expected_duration, rollType, wordCount),
           suggested_broll_visuals: rollType === 'B' ? suggestVisuals(breakpoint, scene) : '',
           suggested_sound_effects: suggestSoundEffects(breakpoint, scene),
-          emotional_tone: determineEmotionalTone(breakpoint, scene)
+          emotional_tone: determineEmotionalTone(breakpoint, scene),
+          shot_notes: shotNotes
         };
         
     ```
  
- 3. Ensure proper balance between A-roll and B-roll content:
+ 3. Ensure proper balance between A-roll and B-roll content and follow duration guidelines:
     ```javascript
     function determineRollType(breakpoint, index, totalShots) {
       }
     }
+    
+    function calculateDuration(breakpoint, sceneDuration, rollType, wordCount) {
+      if (rollType === 'B') {
+        // B-roll duration guideline: 5-13 narration words (approximately 2-5 seconds)
+        return Math.min(Math.max(wordCount * 0.4, 2), 5); // Convert word count to seconds with bounds
+      } else {
+        // A-roll duration is more flexible, based on content complexity
+        return estimateDurationFromContent(breakpoint, sceneDuration);
+      }
+    }
+    
+    function generateStructuredNotes(breakpoint, scene, rollType) {
+      return `### Shot Goals
+ ${determineShotGoals(breakpoint, scene, rollType)}
+ 
+ ### Engagement Strategy
+ ${determineEngagementStrategy(breakpoint, scene, rollType)}
+ 
+ ### Emotional Connection
+ ${determineEmotionalConnection(breakpoint, scene, rollType)}
+ 
+ ### Visual and Audio Cues
+ ${determineVisualAudioCues(breakpoint, scene, rollType)}
+ 
+ ### Additional Context
+ ${determineAdditionalContext(breakpoint, scene, rollType)}`;
+    }
     ```
  
  
  2. **Shot Duration:** Consider appropriate duration for different shot types:
-    - Shorter shots (2-4 seconds) for B-roll and transitional moments
+    - B-roll shots: 5-13 narration words (approximately 2-5 seconds)
     - Medium shots (4-8 seconds) for standard A-roll content
     - Longer shots (8+ seconds) for complex explanations or emotional moments
     - Use contrasting visuals for emphasis or scene changes
     - Consider transition speed based on emotional tone and pacing
+    - Plan for intercutting A-roll with B-roll at natural narrative breaks
  
  4. **Narrative Arc:** Structure shots to support the narrative flow:
  - Calculate expected_duration based on narration speed and content complexity
  - Consider the downstream needs of the B-Roll Ideation node when structuring output
+ - Analyze word count in narration segments to ensure B-roll shots follow the 5-13 word guideline
  
  Your role is crucial in establishing the visual foundation of the video. Your expertise in breaking down narrative content into compelling visual sequences ensures the final video maintains viewer engagement through appropriate pacing, rhythm, and visual variety.
```

---

The Shot Segmentation instructions have been successfully updated with all the important elements from the Agent Brief. The key improvements include:

1. **More Detailed Narrative Break Analysis**
   - Added specific steps for identifying natural breaks and emotional beats in narration
   - Included guidance on looking for transitions in subject matter

2. **B-Roll Duration Guidelines**
   - Added specific criteria: 5-13 narration words (approximately 2-5 seconds)
   - Implemented word count tracking and duration calculation logic

3. **Structured Shot Notes Format**
   - Added a structured markdown template with consistent headers:
     - Shot Goals
     - Engagement Strategy
     - Emotional Connection
     - Visual and Audio Cues
     - Additional Context

4. **Blended Shot Approaches**
   - Added a new section on intercutting A-roll with B-roll
   - Provided guidance on creating rhythmic patterns for maintaining viewer interest

5. **Enhanced Output Structure**
   - Added shot_number, shot_title, narration_text, and word_count fields
   - Included the structured shot_notes field with markdown formatting

6. **Improved Processing Logic**
   - Updated the calculateDuration function to account for word count in B-roll shots
   - Added generateStructuredNotes function to create consistent shot documentation

These enhancements ensure the Shot Segmentation agent will create more precise, structured, and consistent output that maintains the detailed approach from the original Agent Brief while fitting seamlessly into the n8n workflow.

---

_**User**_

OK anything else?

---

_**Assistant**_

The Shot Segmentation agent instructions now comprehensively incorporate all the key elements from the Agent Brief while maintaining the structured format required for n8n. The updated document provides clear guidelines on narrative breaks analysis, B-roll duration specifications, shot notes formatting, and blended shot considerations.

There's nothing else significant missing from the original Agent Brief that needs to be added. The instructions now provide a robust framework for the Shot Segmentation agent to:

1. Properly analyze scene content for natural breakpoints
2. Apply consistent word count guidelines for B-roll (5-13 words) 
3. Create structured shot notes with standardized headings
4. Plan for strategic intercutting of A-roll and B-roll
5. Generate comprehensive shot metadata with all required fields

The instructions are now ready to be implemented in the n8n workflow, with all the essential elements from both the workflow specifications and the original Agent Brief fully integrated.

---



---

