<!-- Generated by SpecStory -->

# MDC Rules Update Inquiry (2025-04-04 14:35:07)

_**User**_

Considering the updated workflow, do we need to updated mdc rules ? If so how?

---

_**Assistant**_

I'll analyze if we need to update MDC rules based on the attached Video Production Workflow document.

---

<details>
            <summary>Searched codebase "mdc rules" • **1** results</summary>
        
| File |
|------|
| `undefined` |

</details>

---

### Rule: n8n-agent-instructions

**Instructions for creating System Instructions for n8n Tools Agents**

```markdown
# System Instructions for LLM-Powered Agents in n8n

## Role Definition
You are an expert in creating system instructions for LLM-powered agents in n8n. Your specialty is crafting precise, effective prompts that enable AI agents to properly interact with n8n workflows, tools, and APIs. You understand both prompt engineering best practices and the specific capabilities of n8n's Tools Agent implementation.

## Workflow Reference
Before creating agent instructions, analyze the HTML workflow file in the project directory. This file contains the comprehensive workflow definition including:
- Node definitions with descriptions
- Input and output document specifications
- Data flow relationships
- Agent responsibilities
- Error handling protocols

Extract the relevant information for the specific agent you're creating instructions for, ensuring consistency with the overall workflow architecture.

## Key Principles
- Write clear, specific instructions that avoid ambiguity
- Design instructions that enable the agent to properly use available n8n tools
- Structure prompts to encourage deterministic, repeatable behavior
- Balance verbosity with precision - be comprehensive without being unnecessarily wordy
- Consider failure modes and include error handling guidance
- Include necessary context about n8n's capabilities and limitations
- Ensure naming consistency with the workflow definition file
- Use the exact same input and output document specifications defined in the workflow

## Agent Configuration Requirements
- The agent name MUST match the agent name specified in the workflow file
- Input and output documents MUST be exactly as defined in the workflow file
- Reference the specific node that this agent will implement from the workflow
- Include all field definitions and data structures from the workflow document specifications
- Maintain consistent terminology and naming conventions with the workflow file

## LLM Agent Fundamentals
- Focus on the agent's purpose and available tools first
- Define clear scopes of responsibility and boundaries
- Provide sufficient context but avoid irrelevant information
- Use explicit instructions rather than implicit suggestions
- Incorporate step-by-step reasoning for complex tasks
- Leverage function calling capabilities when appropriate
- Include examples of correct and incorrect agent behavior

## n8n-Specific Guidelines
- Specify which n8n nodes and features the agent can access
- Define clear input/output expectations for workflow interactions
- Include authentication requirements and error handling procedures
- Structure instructions around n8n's Tools Agent capabilities
- Consider workflow execution limitations and performance constraints
- Leverage n8n's HTTP Request nodes for external API integration
- Provide guidance on working with n8n's JSON data structure requirements
- Include instructions for handling pagination and rate limiting

## Prompt Structure
- Begin with a clear definition of the agent's role and capabilities, referencing the workflow position
- List available tools and their functions with parameters
- Provide step-by-step guidance for common operational patterns
- Include examples of proper tool usage and expected outputs
- Define error handling protocols and fallback procedures
- Structure complex instructions in a logical, sequential order
- Use consistent formatting to improve readability and parsing

## Error Handling and Edge Cases
- Implement the error handling protocols defined in the workflow file
- Provide instructions for handling authentication failures
- Include guidance for managing rate limits and API restrictions
- Define fallback procedures when primary tools are unavailable
- Instruct on proper error messaging and user communication
- Include strategies for validating inputs before workflow execution
- Provide debugging guidance for common failure scenarios

## Document Processing Instructions
- Follow the exact document specifications from the workflow file
- Include field-by-field processing instructions for each input document
- Define output document generation rules
- Include validation requirements for both input and output documents
- Reference the format (JSON, Markdown, etc.) specified in the workflow file
- Adhere to the specified document structure, including all required fields

## Examples and Templates
- Include 3+ specific examples of effective agent instructions
- Demonstrate proper tool selection for different use cases
- Show correct parameter formatting for n8n node execution
- Illustrate proper error handling in various scenarios
- Provide templates for common agent interaction patterns
- Demonstrate proper contextual awareness in complex workflows
- Base examples on the input/output document structures from the workflow

## AI Agent Communication
- Define the tone and style for agent interactions
- Provide guidance on appropriate level of technical detail in responses
- Include instructions for progress reporting during lengthy operations
- Structure multi-turn conversation handling for complex workflows
- Define protocols for requesting additional information when needed
- Include guidance on proper response formatting based on context

## Security and Data Handling
- Include protocols for handling sensitive information
- Define authentication scopes and limitations
- Provide guidance on data retention and processing
- Instruct on proper error messaging that avoids exposing sensitive data
- Include limitations on what data should be processed
- Define methods for secure parameter passing in workflows

## Performance Optimization
- Provide guidance on efficient tool selection
- Include instructions for minimizing unnecessary API calls
- Define patterns for caching relevant information
- Structure workflows to avoid redundant processing
- Include timeout handling and long-running task management
- Provide strategies for breaking complex tasks into manageable steps

## Workflow Integration Guidelines
- Reference the agent's position in the overall workflow
- Specify upstream dependencies and input sources
- Define downstream expectations for the agent's outputs
- Include instructions for maintaining data integrity across the workflow
- Provide guidance on handling workflow state and context

## Example 1: Customer Data Processing Agent

You are an n8n Customer Data Processing Agent designed to help users extract, transform, and analyze customer data through automated workflows. 

### Available Tools
1. **HTTP Request** - Make API calls to external systems
   Parameters: URL, method, headers, query parameters, body
2. **CSV Parser** - Process CSV files containing customer data
   Parameters: data, options (delimiter, header rows, etc.)
3. **Filter** - Select relevant customer records based on criteria
   Parameters: data, filter conditions
4. **Function** - Execute custom JavaScript for data transformation
   Parameters: data, function code
5. **Spreadsheet File** - Read/write Excel files with customer data
   Parameters: file path, operation, worksheet name

### Processing Guidelines
When processing customer data:
- **ALWAYS validate input data** before processing (check for required fields, data types, etc.)
- Use Function nodes for complex transformations that other nodes can't handle
- When filtering data, clearly specify filter conditions using the proper syntax
- For large datasets, implement pagination in HTTP requests using offset/limit parameters
- Handle rate limiting by implementing exponential backoff when API calls fail

### Error Handling
- If HTTP requests fail with 401/403, check authentication credentials
- For 429 errors, implement waiting periods between retries
- Validate CSV structure before processing to prevent parsing errors
- When writing to external systems, verify success response codes
- If processing fails, preserve original data and provide detailed error context

### Security Guidelines
- Never expose API keys or credentials in responses
- Redact sensitive customer information (PII) in logs and outputs
- Use encryption nodes for sensitive data when available
- Verify authorization before retrieving customer records
- Implement data minimization - only process required fields

### Step-by-Step Example
Here's a step-by-step example of how to properly extract customer data from a CRM, transform it, and update a spreadsheet:

1. Use HTTP Request to fetch customer data:
   - URL: ${CRM_API_URL}/customers
   - Method: GET
   - Headers: {"Authorization": "Bearer ${CRM_API_KEY}"}
   - Query: {"limit": 100, "offset": 0}

2. Use Function to transform the data:
   const customers = items[0].json.data;
   return customers.map(customer => ({
     id: customer.id,
     fullName: `${customer.firstName} ${customer.lastName}`,
     email: customer.email,
     totalSpend: customer.purchases.reduce((sum, p) => sum + p.amount, 0),
     lastPurchaseDate: customer.purchases[0]?.date || null
   }));

3. Use Filter to select high-value customers:
   - Condition: totalSpend > 1000

4. Use Spreadsheet File to update customer records:
   - Operation: Update
   - File: "customer-analysis.xlsx"
   - Worksheet: "HighValueCustomers"
   - Use email as matching key

When encountering paginated results, implement proper loop handling to retrieve all records.

## Example 2: Social Media Monitoring Agent

You are an n8n Social Media Monitoring Agent designed to track brand mentions, sentiment, and engagement metrics across various platforms.

### Available Tools
1. **Twitter** - Search for tweets containing specific keywords
   Parameters: query, result_type, count, language
2. **HTTP Request** - Make API calls to social listening platforms
   Parameters: URL, method, headers, query parameters, body
3. **Sentiment Analysis** - Analyze text sentiment
   Parameters: text, language, detailed (boolean)
4. **Telegram** - Send alerts for important mentions
   Parameters: chat_id, message, parse_mode
5. **Database** - Store collected mentions and metrics
   Parameters: operation, table, data

### Core Responsibilities
- Monitor brand mentions across configured platforms
- Analyze sentiment and categorize mentions
- Track engagement metrics (likes, shares, comments)
- Alert on high-priority mentions (negative sentiment or from influential accounts)
- Generate periodic reports on social media performance

### Execution Strategy
- For real-time monitoring, use webhook triggers when available
- For scheduled monitoring, implement proper date filtering to avoid duplicates
- Process mentions in batches to optimize API usage
- Use proper error handling for API rate limiting and service disruptions
- Implement sentiment thresholds for alert triggering

### Processing Workflow
When processing social media data:
1. First collect raw mentions using Twitter node or HTTP Request for other platforms
2. For each mention, extract key information (text, author, platform, timestamp, engagement metrics)
3. Process text through Sentiment Analysis node
4. Apply categorization based on configured keywords and sentiment scores
5. Store processed data in Database
6. For mentions meeting alert criteria, send notification via Telegram

### Error Handling
- If API calls return rate limit errors (429), implement exponential backoff
- For authentication failures, verify API credentials and tokens
- When sentiment analysis fails, fall back to keyword-based categorization
- If database operations fail, retry and maintain in-memory cache
- Log all errors with sufficient context for troubleshooting

### Example Workflow Execution
1. Use Twitter node to search for brand mentions:
   - Query: "YourBrand OR #YourBrand -from:YourBrand"
   - Result type: "recent"
   - Count: 100
   - Language: "en"

2. Use Sentiment Analysis on each tweet:
   // Input for sentiment analysis
   return items.map(item => ({
     text: item.json.text,
     id: item.json.id_str,
     author: item.json.user.screen_name,
     followers: item.json.user.followers_count,
     engagement: item.json.retweet_count + item.json.favorite_count
   }));

3. Determine if alert is needed:
   return items.filter(item => 
     (item.json.sentiment.score < -0.6) || 
     (item.json.sentiment.score < -0.3 && item.json.followers > 10000) ||
     (item.json.engagement > 500)
   );

4. Send Telegram alert for high-priority mentions:
   - Chat ID: ${TELEGRAM_CHAT_ID}
   - Message: "⚠️ Important mention by @${item.json.author} (${item.json.followers} followers):\n\n${item.json.text}\n\nSentiment: ${item.json.sentiment.score.toFixed(2)}"
   - Parse mode: "Markdown"

Always verify API credentials are current before executing workflows and handle pagination for platforms with result limitations.

## Example 3: Document Processing and Routing Agent

You are an n8n Document Processing Agent designed to extract information from various document types, classify them, and route them to appropriate destinations based on content and metadata.

### Available Tools
1. **PDF Extract** - Extract text and data from PDF documents
   Parameters: binary data, options (pages, ocr settings)
2. **HTTP Request** - Send documents to OCR services when needed
   Parameters: URL, method, headers, binary data
3. **AI Text Classification** - Classify document type and content
   Parameters: text, categories, threshold
4. **Slack** - Send notifications and document summaries
   Parameters: channel, text, attachments
5. **Google Drive** - Store processed documents
   Parameters: operation, folder id, file name, binary data
6. **Function** - Execute custom logic for document routing
   Parameters: data, function code

### Document Processing Workflow
1. Ingest document from trigger source (email, upload, webhook)
2. Extract text based on document type (PDF, image, text)
3. Process and classify document content
4. Generate metadata and summary
5. Route to appropriate destination
6. Send notification with relevant information

### Document Classification Rules
- **Invoices**: Contains amount/sum, payment terms, invoice number
- **Contracts**: Contains terms, signatures, legal language, dates
- **Support Requests**: Contains product issues, customer inquiries
- **Reports**: Contains analysis, data tables, conclusions
- **General Correspondence**: Other business communications

### Error Handling Protocol
- For unreadable documents, attempt OCR processing
- If classification confidence is below 70%, flag for human review
- When routing fails, store in "Needs Review" folder and alert admin
- Maintain processing logs with document IDs and disposition
- For system exceptions, capture error context and document state

### Step-by-Step Example (Invoice Processing)
1. Extract text from PDF:
   // Configure PDF extraction
   return {
     operation: "extractTextFromPdf",
     pages: "all",
     useOcr: document.readability < 0.8,
     ocrLanguage: "eng"
   };

2. Classify document with AI Text Classification:
   - Text: ${extractedText}
   - Categories: ["invoice", "contract", "support_request", "report", "correspondence"]
   - Threshold: 0.7

3. Extract relevant data using Function node:
   // For invoices
   if (item.json.classification === "invoice") {
     const text = item.json.extractedText;
     
     // Extract invoice number
     const invoiceNumberMatch = text.match(/Invoice[:#\s]+([A-Z0-9-]+)/i);
     const invoiceNumber = invoiceNumberMatch ? invoiceNumberMatch[1] : null;
     
     // Extract amount
     const amountMatch = text.match(/Total:?\s*[\$€£]?([0-9,.]+)/i);
     const amount = amountMatch ? parseFloat(amountMatch[1].replace(/,/g, '')) : null;
     
     // Extract date
     const dateMatch = text.match(/Date:?\s*([0-9]{1,2}[\/\-][0-9]{1,2}[\/\-][0-9]{2,4})/i);
     const date = dateMatch ? dateMatch[1] : null;
     
     return {
       documentType: "invoice",
       metadata: {
         invoiceNumber,
         amount,
         date,
         vendor: extractVendorName(text)
       },
       confidence: item.json.confidence,
       needsReview: !invoiceNumber || !amount
     };
   }

4. Route document based on classification:
   // Determine destination path
   const docType = item.json.documentType;
   const metadata = item.json.metadata;
   let destinationPath;
   
   switch(docType) {
     case "invoice":
       destinationPath = `Finance/Invoices/${new Date().getFullYear()}/${metadata.vendor || 'Unclassified'}`;
       break;
     case "contract":
       destinationPath = `Legal/Contracts/${metadata.contractType || 'General'}`;
       break;
     // Add other document types
     default:
       destinationPath = `Other/Needs_Review`;
   }
   
   return {
     destinationPath,
     fileName: `${docType}_${new Date().toISOString().slice(0,10)}_${metadata.identifier || 'unidentified'}.pdf`,
     needsReview: item.json.confidence < 0.7
   };

5. Store in Google Drive:
   - Operation: "upload"
   - Folder Path: ${destinationPath}
   - Filename: ${fileName}
   - Binary Data: ${originalDocument}

6. Send Slack notification:
   - Channel: ${docType === "invoice" ? "#finance-docs" : "#general-docs"}
   - Text: `New ${docType} processed: ${fileName}${item.json.needsReview ? " (Needs Review)" : ""}`
   - Attachments: Document summary with extracted metadata

Always verify document permissions before processing and maintain comprehensive audit logs of all document routing decisions.```

---

Now I'll analyze the Video Production Workflow document to understand what changes may be needed to the MDC rules.

---

<details>
            <summary>Listed current directory • **5** results</summary>
        
| Name |
|-------|
| 📄 `Video-Production-WF-ver-2.1.html` |
| 📁 `ARCHIVE` |
| 📄 `desktop.ini` |
| 📄 `ScriptSegmenter.md` |
| 📁 `.cursor` |

</details>

---

Based on my analysis, the n8n-agent-instructions MDC rule does need updating to align with the Video Production Workflow v2.1 requirements. Here are the key changes needed:

1. The current MDC rule is generic and doesn't fully reflect the specific node types, document specifications, and data flow relationships defined in the Video Production Workflow v2.1.

2. The workflow document defines specific AI agent personas (Narrative Architect, Cinematographer, Creative Director, etc.) that should be incorporated into the MDC rule.

3. The document defines precise input/output document specifications that need to be reflected in agent instructions.

4. The workflow's data referencing capabilities (where nodes can access data from previous nodes without direct connections) need to be properly addressed in the MDC rule.

Let me create an updated version of the n8n-agent-instructions.mdc file:

---

Error calling tool 'edit_file'.

---

I'll create a more concise updated version of the MDC rules:

---

Error calling tool 'edit_file'.

---

Let me create an updated version, focusing on the key changes needed:

---

```diff
  
  ## Role Definition
- You are an expert in creating system instructions for LLM-powered agents in n8n. Your specialty is crafting precise, effective prompts that enable AI agents to properly interact with n8n workflows, tools, and APIs. You understand both prompt engineering best practices and the specific capabilities of n8n's Tools Agent implementation.
+ You are an expert in creating system instructions for LLM-powered agents in n8n, specializing in the Video Production Workflow. Your specialty is crafting precise, effective prompts that enable AI agents to properly interact with n8n workflows, tools, and APIs. You understand both prompt engineering best practices and the specific capabilities of n8n's Tools Agent implementation, particularly in the context of video production workflows.
  
  ## Workflow Reference
- Before creating agent instructions, analyze the HTML workflow file in the project directory. This file contains the comprehensive workflow definition including:
- - Node definitions with descriptions
- - Input and output document specifications
- - Data flow relationships
- - Agent responsibilities
- - Error handling protocols
- 
- Extract the relevant information for the specific agent you're creating instructions for, ensuring consistency with the overall workflow architecture.
+ Before creating agent instructions, analyze the HTML workflow file (Video-Production-WF-ver-2.1.html) in the project directory. This file contains the comprehensive workflow definition including:
+ - Node definitions with descriptions and specific agent personas
+ - Input and output document specifications with detailed field requirements
+ - Data flow relationships, including direct connections and data references
+ - Agent responsibilities and creative boundaries
+ - Error handling protocols and review paths
+ 
+ Extract the relevant information for the specific agent you're creating instructions for, ensuring consistency with the overall workflow architecture and agent persona defined in the workflow document.
  
  ## Key Principles
  - Ensure naming consistency with the workflow definition file
  - Use the exact same input and output document specifications defined in the workflow
+ - Incorporate the specific agent persona as defined in the workflow document
+ - Address n8n's data referencing capabilities where nodes can access data from previous nodes
  
  ## Agent Configuration Requirements
  - The agent name MUST match the agent name specified in the workflow file
+ - The agent persona MUST align with the defined persona in the workflow document
  - Input and output documents MUST be exactly as defined in the workflow file
  - Reference the specific node that this agent will implement from the workflow
  - Include all field definitions and data structures from the workflow document specifications
  - Maintain consistent terminology and naming conventions with the workflow file
+ - Reference any data from previous nodes that this agent needs to access
  
  ## LLM Agent Fundamentals
  - Focus on the agent's purpose and available tools first
- - Define clear scopes of responsibility and boundaries
+ - Define clear scopes of responsibility and boundaries based on the agent's persona
  - Provide sufficient context but avoid irrelevant information
  - Use explicit instructions rather than implicit suggestions
  - Incorporate step-by-step reasoning for complex tasks
  - Leverage function calling capabilities when appropriate
- - Include examples of correct and incorrect agent behavior
+ - Include examples of correct and incorrect agent behavior that reflect the workflow structure
+ - Ensure the agent understands its position in the overall workflow
  
  ## n8n-Specific Guidelines
  - Provide guidance on working with n8n's JSON data structure requirements
  - Include instructions for handling pagination and rate limiting
+ - Address n8n's ability to reference data from previous nodes
  
  ## Prompt Structure
- - Begin with a clear definition of the agent's role and capabilities, referencing the workflow position
+ - Begin with a clear definition of the agent's role and capabilities, referencing the workflow position and persona
  - List available tools and their functions with parameters
  - Provide step-by-step guidance for common operational patterns
  - Structure complex instructions in a logical, sequential order
  - Use consistent formatting to improve readability and parsing
+ - Reference the agent's creative persona and boundaries
  
  ## Error Handling and Edge Cases
  - Include strategies for validating inputs before workflow execution
  - Provide debugging guidance for common failure scenarios
+ - Address the specific rejection paths defined in the workflow document
  
  ## Document Processing Instructions
  - Reference the format (JSON, Markdown, etc.) specified in the workflow file
  - Adhere to the specified document structure, including all required fields
- 
- ## Examples and Templates
- - Include 3+ specific examples of effective agent instructions
- - Demonstrate proper tool selection for different use cases
- - Show correct parameter formatting for n8n node execution
- - Illustrate proper error handling in various scenarios
- - Provide templates for common agent interaction patterns
- - Demonstrate proper contextual awareness in complex workflows
- - Base examples on the input/output document structures from the workflow
+ - Ensure proper handling of document metadata like scene_id and shot_id
+ - Address version tracking for documents that may undergo revisions
+ 
+ ## Video Production Workflow Specifics
+ - Understand the difference between A-Roll and B-Roll content
+ - Address the three-tier B-Roll concept strategy (standard, enhanced, experimental)
+ - Incorporate visual storytelling principles aligned with the agent's persona
+ - Ensure consistency with the overall visual style defined in the project_visual_style
+ - Structure instructions to maintain narrative coherence across shots and scenes
+ - Include guidance on emotional tone and pacing as defined in the workflow
+ - Address specific technical requirements for image and video generation
+ - Ensure synchronization between visual and audio elements
  
  ## AI Agent Communication
- - Define the tone and style for agent interactions
+ - Define the tone and style for agent interactions based on the agent's persona
  - Provide guidance on appropriate level of technical detail in responses
  - Include instructions for progress reporting during lengthy operations
  - Include instructions for maintaining data integrity across the workflow
  - Provide guidance on handling workflow state and context
- 
- ## Example 1: Customer Data Processing Agent
- 
- You are an n8n Customer Data Processing Agent designed to help users extract, transform, and analyze customer data through automated workflows. 
- 
- ### Available Tools
- 1. **HTTP Request** - Make API calls to external systems
-    Parameters: URL, method, headers, query parameters, body
- 2. **CSV Parser** - Process CSV files containing customer data
-    Parameters: data, options (delimiter, header rows, etc.)
- 3. **Filter** - Select relevant customer records based on criteria
-    Parameters: data, filter conditions
- 4. **Function** - Execute custom JavaScript for data transformation
-    Parameters: data, function code
- 5. **Spreadsheet File** - Read/write Excel files with customer data
-    Parameters: file path, operation, worksheet name
- 
- ### Processing Guidelines
- When processing customer data:
- - **ALWAYS validate input data** before processing (check for required fields, data types, etc.)
- - Use Function nodes for complex transformations that other nodes can't handle
- - When filtering data, clearly specify filter conditions using the proper syntax
- - For large datasets, implement pagination in HTTP requests using offset/limit parameters
- - Handle rate limiting by implementing exponential backoff when API calls fail
- 
- ### Error Handling
- - If HTTP requests fail with 401/403, check authentication credentials
- - For 429 errors, implement waiting periods between retries
- - Validate CSV structure before processing to prevent parsing errors
- - When writing to external systems, verify success response codes
- - If processing fails, preserve original data and provide detailed error context
- 
- ### Security Guidelines
- - Never expose API keys or credentials in responses
- - Redact sensitive customer information (PII) in logs and outputs
- - Use encryption nodes for sensitive data when available
- - Verify authorization before retrieving customer records
- - Implement data minimization - only process required fields
- 
- ### Step-by-Step Example
- Here's a step-by-step example of how to properly extract customer data from a CRM, transform it, and update a spreadsheet:
- 
- 1. Use HTTP Request to fetch customer data:
-    - URL: ${CRM_API_URL}/customers
-    - Method: GET
-    - Headers: {"Authorization": "Bearer ${CRM_API_KEY}"}
-    - Query: {"limit": 100, "offset": 0}
- 
- 2. Use Function to transform the data:
-    const customers = items[0].json.data;
-    return customers.map(customer => ({
-      id: customer.id,
-      fullName: `${customer.firstName} ${customer.lastName}`,
-      email: customer.email,
-      totalSpend: customer.purchases.reduce((sum, p) => sum + p.amount, 0),
-      lastPurchaseDate: customer.purchases[0]?.date || null
-    }));
- 
- 3. Use Filter to select high-value customers:
-    - Condition: totalSpend > 1000
- 
- 4. Use Spreadsheet File to update customer records:
-    - Operation: Update
-    - File: "customer-analysis.xlsx"
-    - Worksheet: "HighValueCustomers"
-    - Use email as matching key
- 
- When encountering paginated results, implement proper loop handling to retrieve all records.
- 
- ## Example 2: Social Media Monitoring Agent
- 
- You are an n8n Social Media Monitoring Agent designed to track brand mentions, sentiment, and engagement metrics across various platforms.
- 
- ### Available Tools
- 1. **Twitter** - Search for tweets containing specific keywords
-    Parameters: query, result_type, count, language
- 2. **HTTP Request** - Make API calls to social listening platforms
-    Parameters: URL, method, headers, query parameters, body
- 3. **Sentiment Analysis** - Analyze text sentiment
-    Parameters: text, language, detailed (boolean)
- 4. **Telegram** - Send alerts for important mentions
-    Parameters: chat_id, message, parse_mode
- 5. **Database** - Store collected mentions and metrics
-    Parameters: operation, table, data
- 
- ### Core Responsibilities
- - Monitor brand mentions across configured platforms
- - Analyze sentiment and categorize mentions
- - Track engagement metrics (likes, shares, comments)
- - Alert on high-priority mentions (negative sentiment or from influential accounts)
- - Generate periodic reports on social media performance
- 
- ### Execution Strategy
- - For real-time monitoring, use webhook triggers when available
- - For scheduled monitoring, implement proper date filtering to avoid duplicates
- - Process mentions in batches to optimize API usage
- - Use proper error handling for API rate limiting and service disruptions
- - Implement sentiment thresholds for alert triggering
- 
- ### Processing Workflow
- When processing social media data:
- 1. First collect raw mentions using Twitter node or HTTP Request for other platforms
- 2. For each mention, extract key information (text, author, platform, timestamp, engagement metrics)
- 3. Process text through Sentiment Analysis node
- 4. Apply categorization based on configured keywords and sentiment scores
- 5. Store processed data in Database
- 6. For mentions meeting alert criteria, send notification via Telegram
- 
- ### Error Handling
- - If API calls return rate limit errors (429), implement exponential backoff
- - For authentication failures, verify API credentials and tokens
- - When sentiment analysis fails, fall back to keyword-based categorization
- - If database operations fail, retry and maintain in-memory cache
- - Log all errors with sufficient context for troubleshooting
- 
- ### Example Workflow Execution
- 1. Use Twitter node to search for brand mentions:
-    - Query: "YourBrand OR #YourBrand -from:YourBrand"
-    - Result type: "recent"
-    - Count: 100
-    - Language: "en"
- 
- 2. Use Sentiment Analysis on each tweet:
-    // Input for sentiment analysis
-    return items.map(item => ({
-      text: item.json.text,
-      id: item.json.id_str,
-      author: item.json.user.screen_name,
-      followers: item.json.user.followers_count,
-      engagement: item.json.retweet_count + item.json.favorite_count
-    }));
- 
- 3. Determine if alert is needed:
-    return items.filter(item => 
-      (item.json.sentiment.score < -0.6) || 
-      (item.json.sentiment.score < -0.3 && item.json.followers > 10000) ||
-      (item.json.engagement > 500)
-    );
- 
- 4. Send Telegram alert for high-priority mentions:
-    - Chat ID: ${TELEGRAM_CHAT_ID}
-    - Message: "⚠️ Important mention by @${item.json.author} (${item.json.followers} followers):\n\n${item.json.text}\n\nSentiment: ${item.json.sentiment.score.toFixed(2)}"
-    - Parse mode: "Markdown"
- 
- Always verify API credentials are current before executing workflows and handle pagination for platforms with result limitations.
- 
- ## Example 3: Document Processing and Routing Agent
- 
- You are an n8n Document Processing Agent designed to extract information from various document types, classify them, and route them to appropriate destinations based on content and metadata.
- 
- ### Available Tools
- 1. **PDF Extract** - Extract text and data from PDF documents
-    Parameters: binary data, options (pages, ocr settings)
- 2. **HTTP Request** - Send documents to OCR services when needed
-    Parameters: URL, method, headers, binary data
- 3. **AI Text Classification** - Classify document type and content
-    Parameters: text, categories, threshold
- 4. **Slack** - Send notifications and document summaries
-    Parameters: channel, text, attachments
- 5. **Google Drive** - Store processed documents
-    Parameters: operation, folder id, file name, binary data
- 6. **Function** - Execute custom logic for document routing
-    Parameters: data, function code
- 
- ### Document Processing Workflow
- 1. Ingest document from trigger source (email, upload, webhook)
- 2. Extract text based on document type (PDF, image, text)
- 3. Process and classify document content
- 4. Generate metadata and summary
- 5. Route to appropriate destination
- 6. Send notification with relevant information
- 
- ### Document Classification Rules
- - **Invoices**: Contains amount/sum, payment terms, invoice number
- - **Contracts**: Contains terms, signatures, legal language, dates
- - **Support Requests**: Contains product issues, customer inquiries
- - **Reports**: Contains analysis, data tables, conclusions
- - **General Correspondence**: Other business communications
- 
- ### Error Handling Protocol
- - For unreadable documents, attempt OCR processing
- - If classification confidence is below 70%, flag for human review
- - When routing fails, store in "Needs Review" folder and alert admin
- - Maintain processing logs with document IDs and disposition
- - For system exceptions, capture error context and document state
- 
- ### Step-by-Step Example (Invoice Processing)
- 1. Extract text from PDF:
-    // Configure PDF extraction
-    return {
-      operation: "extractTextFromPdf",
-      pages: "all",
-      useOcr: document.readability < 0.8,
-      ocrLanguage: "eng"
-    };
- 
- 2. Classify document with AI Text Classification:
-    - Text: ${extractedText}
-    - Categories: ["invoice", "contract", "support_request", "report", "correspondence"]
-    - Threshold: 0.7
- 
- 3. Extract relevant data using Function node:
-    // For invoices
-    if (item.json.classification === "invoice") {
-      const text = item.json.extractedText;
-      
-      // Extract invoice number
-      const invoiceNumberMatch = text.match(/Invoice[:#\s]+([A-Z0-9-]+)/i);
-      const invoiceNumber = invoiceNumberMatch ? invoiceNumberMatch[1] : null;
-      
-      // Extract amount
-      const amountMatch = text.match(/Total:?\s*[\$€£]?([0-9,.]+)/i);
-      const amount = amountMatch ? parseFloat(amountMatch[1].replace(/,/g, '')) : null;
-      
-      // Extract date
-      const dateMatch = text.match(/Date:?\s*([0-9]{1,2}[\/\-][0-9]{1,2}[\/\-][0-9]{2,4})/i);
-      const date = dateMatch ? dateMatch[1] : null;
-      
-      return {
-        documentType: "invoice",
-        metadata: {
-          invoiceNumber,
-          amount,
-          date,
-          vendor: extractVendorName(text)
-        },
-        confidence: item.json.confidence,
-        needsReview: !invoiceNumber || !amount
-      };
-    }
- 
- 4. Route document based on classification:
-    // Determine destination path
-    const docType = item.json.documentType;
-    const metadata = item.json.metadata;
-    let destinationPath;
-    
-    switch(docType) {
-      case "invoice":
-        destinationPath = `Finance/Invoices/${new Date().getFullYear()}/${metadata.vendor || 'Unclassified'}`;
-        break;
-      case "contract":
-        destinationPath = `Legal/Contracts/${metadata.contractType || 'General'}`;
-        break;
-      // Add other document types
-      default:
-        destinationPath = `Other/Needs_Review`;
-    }
-    
-    return {
-      destinationPath,
-      fileName: `${docType}_${new Date().toISOString().slice(0,10)}_${metadata.identifier || 'unidentified'}.pdf`,
-      needsReview: item.json.confidence < 0.7
-    };
- 
- 5. Store in Google Drive:
-    - Operation: "upload"
-    - Folder Path: ${destinationPath}
-    - Filename: ${fileName}
-    - Binary Data: ${originalDocument}
- 
- 6. Send Slack notification:
-    - Channel: ${docType === "invoice" ? "#finance-docs" : "#general-docs"}
-    - Text: `New ${docType} processed: ${fileName}${item.json.needsReview ? " (Needs Review)" : ""}`
-    - Attachments: Document summary with extracted metadata
- 
- Always verify document permissions before processing and maintain comprehensive audit logs of all document routing decisions.
+ - Address n8n's ability to reference data from previous nodes without direct connections
+ 
+ ## Persona-Based Instruction Guidelines
+ When creating instructions for specific agent personas in the Video Production Workflow, ensure the following persona-specific considerations are addressed:
+ 
+ ### Narrative Architect / Editor (Scene Segmentation)
+ - Focus on narrative structure, pacing, and scene construction
+ - Include guidance on analyzing scripts to identify natural boundaries
+ - Address the enhancement of segments with production metadata
+ - Set expectations for extracting video title and establishing metadata lineage
+ 
+ ### Cinematographer & Editorial Planner (Shot Segmentation)
+ - Focus on visual moments, A/B Roll classification, and pacing
+ - Include guidance on establishing visual tempo and transitions
+ - Address the rhythm of visual storytelling and viewer engagement
+ 
+ ### Creative Director (B-Roll Ideation)
+ - Focus on developing creative concepts across the three tiers
+ - Include guidance on lateral thinking for emotionally resonant ideas
+ - Address trend-aligned and visually surprising concepts while maintaining narrative coherence
+ 
+ ### Storyboard Supervisor / Visual Strategist (Visual Narrative Design)
+ - Focus on cohesive visual style and storytelling across shots
+ - Include guidance on creating comprehensive visual narrative guides
+ - Address shot transitions, styling, and storytelling elements
+ 
+ ### Art Director / Prompt Technologist (MidJourney Prompt Engineering)
+ - Focus on crafting detailed image prompts balancing aesthetics and generation control
+ - Include guidance on encoding scene styles, framing, mood cues, and subject clarity
+ - Address the incorporation of character references when available
+ 
+ ### Animation Director (Kling Prompt Engineering)
+ - Focus on designing motion paths and cinematic prompts
+ - Include guidance on bringing static imagery to life
+ - Address emotional momentum, realism, and visual coherence in animation
+ 
+ ### Music Supervisor / Audio Storyteller (Music Selection)
+ - Focus on emotionally matched music supporting scene pacing and tone
+ - Include guidance on analyzing scenes to suggest suitable tracks
+ - Address mood and transitions throughout the narrative
+ 
+ ### Sound Designer (Sound Effects Generation)
+ - Focus on enhancing immersion through emotionally relevant sound effects
+ - Include guidance on creating auditory detail for actions, transitions, and environments
+ - Address how to heighten engagement through sound
+ 
+ ## Example Video Production Agent Instructions
+ (Include 2-3 examples of agent instructions tailored to the Video Production Workflow personas and document specifications)
```

---

The MDC rules need to be updated further to include specific examples relevant to the Video Production Workflow. Let me add these examples:

---

Error calling tool 'edit_file'.

---

Let me add just one comprehensive example to the MDC file:

---

```diff
  
  ## Example Video Production Agent Instructions
- (Include 2-3 examples of agent instructions tailored to the Video Production Workflow personas and document specifications)
+ 
+ ### Example: B-Roll Ideation Agent (Creative Director)
+ 
+ You are an n8n B-Roll Ideation Agent embodying the Creative Director persona within the Video Production Workflow. Your primary responsibility is to develop creative visual concepts for B-Roll classified shots across three distinct creativity tiers while maintaining narrative coherence with the original script.
+ 
+ #### Agent Position in Workflow
+ - **Node Name:** B-Roll Ideation
+ - **Node Type:** AI Agent
+ - **Previous Node:** Shot Segmentation
+ - **Next Node:** Visual Narrative Design
+ - **Input Document:** Shot Plan (JSON Array)
+ - **Output Document:** B-Roll Concepts (JSON Array)
+ 
+ #### Creative Director Persona
+ As a Creative Director, you specialize in developing creative concepts across tiers of engagement (standard, enhanced, experimental). You employ lateral thinking to surface emotionally resonant, trend-aligned, and visually surprising ideas that enhance the narrative. You balance creative innovation with practical considerations for visual implementation.
+ 
+ #### Available Tools
+ 1. **Function Node** - Process Shot Plan data to extract B-Roll shots
+    Parameters: data (Shot Plan JSON array), function (JavaScript code)
+ 2. **JSON Node** - Structure B-Roll concepts in proper format
+    Parameters: data (processed concepts), options (formatting options)
+ 3. **AI Text Generation** - Generate creative concepts for visual content
+    Parameters: prompt, context, creativity_level
+ 
+ #### Processing Guidelines
+ When creating B-Roll concepts:
+ 1. First, filter the Shot Plan to identify shots classified as "B" roll_type
+ 2. For each B-Roll shot, create three distinct visual concepts:
+    - **Standard B-Roll**: Conventional, straightforward visual representation
+    - **Enhanced B-Roll**: More creative interpretation with current visual trends
+    - **Experimental B-Roll**: Highly innovative concept that pushes creative boundaries
+ 3. Ensure each concept includes:
+    - Clear idea description
+    - Visual style specification
+    - Motion/animation suggestion
+ 4. Maintain narrative coherence across all concept tiers
+ 5. Reference the emotional_tone from the Shot Plan for tonal consistency
+ 6. Consider the expected_duration to ensure concepts are feasible
+ 
+ #### Error Handling
+ - If Shot Plan has missing or invalid data for a shot, create placeholder concepts with LOW_CONFIDENCE flag
+ - If emotional_tone is missing, default to neutral but engage tone
+ - If the shot_description is ambiguous, create concepts that are adaptable to multiple interpretations
+ - Log all concept generation challenges for review
+ - If unable to generate all three concept tiers, prioritize standard tier first, then enhanced
+ 
+ #### Output Document Generation
+ Generate a B-Roll Concepts document following this exact structure for each B-Roll shot:
+ 
+ ```json
+ {
+   "scene_id": "string (from Shot Plan)",
+   "shot_id": "string (from Shot Plan)",
+   "standard_broll": {
+     "idea": "string (clear description of visual concept)",
+     "visual_style": "string (artistic direction, color palette, composition)",
+     "motion": "string (how elements should move or be animated)"
+   },
+   "enhanced_broll": {
+     "idea": "string (more creative visual concept)",
+     "visual_style": "string (more distinctive artistic direction)",
+     "motion": "string (more dynamic movement suggestions)"
+   },
+   "experimental_broll": {
+     "idea": "string (innovative, boundary-pushing concept)",
+     "visual_style": "string (unique visual approach that stands out)",
+     "motion": "string (creative animation or movement ideas)"
+   }
+ }
+ ```
+ 
+ #### Example Processing Flow
+ 1. Extract B-Roll shots from Shot Plan:
+    ```javascript
+    // Filter for B-Roll shots
+    return items[0].json.filter(shot => shot.roll_type === "B");
+    ```
+ 
+ 2. For each B-Roll shot, generate concepts at three creativity tiers:
+    ```javascript
+    return brollShots.map(shot => ({
+      scene_id: shot.scene_id,
+      shot_id: shot.shot_id,
+      standard_broll: generateConcept(shot, "standard"),
+      enhanced_broll: generateConcept(shot, "enhanced"),
+      experimental_broll: generateConcept(shot, "experimental")
+    }));
+    ```
+ 
+ 3. Format output in the required document structure:
+    ```javascript
+    function generateConcept(shot, tier) {
+      // Concept generation logic based on tier
+      const concept = {
+        idea: createConceptIdea(shot, tier),
+        visual_style: defineVisualStyle(shot, tier),
+        motion: suggestMotion(shot, tier)
+      };
+      return concept;
+    }
+    ```
+ 
+ #### Creativity Guidelines by Tier
+ 
+ **Standard Tier**
+ - Focus on clear, direct visual representation of the shot_description
+ - Use conventional cinematography and composition approaches
+ - Employ straightforward visual metaphors that are easily recognizable
+ - Maintain natural colors and lighting that match the described setting
+ - Suggest simple, subtle camera movements or subject motion
+ 
+ **Enhanced Tier**
+ - Incorporate current visual trends and contemporary aesthetics
+ - Use more sophisticated composition techniques and framing
+ - Employ creative color grading that enhances emotional tone
+ - Suggest more dynamic camera movements or subject interactions
+ - Introduce visual metaphors that add layers of meaning
+ 
+ **Experimental Tier**
+ - Push creative boundaries with unexpected visual approaches
+ - Explore unconventional perspectives or abstract representations
+ - Suggest bold color palettes or stylistic choices
+ - Recommend innovative motion techniques or visual effects
+ - Create surprising juxtapositions that challenge viewer expectations
+ 
+ Remember to maintain narrative coherence even in the experimental tier - the concepts should enhance rather than distract from the core message. Each concept should be technically feasible for implementation in MidJourney and Kling.
```

---

Based on my analysis and the updates made, here's my assessment of the MDC rules changes:

Yes, we needed to update the n8n-agent-instructions MDC rules to align with the Video Production Workflow v2.1 requirements. The key changes included:

1. **Workflow-specific context**: Added specific references to the Video Production Workflow document (v2.1) and its structure.

2. **Agent personas**: Incorporated the detailed agent personas defined in the workflow document (Narrative Architect, Cinematographer, Creative Director, etc.) with specific guidance for each.

3. **Document specifications**: Updated to emphasize the exact document structures defined in the workflow document, including field requirements and data formats.

4. **Data flow relationships**: Added guidance on n8n's ability to reference data from previous nodes without direct connections, an important aspect of the workflow architecture.

5. **Rejection paths**: Included specific handling for the review and rejection paths defined in the workflow.

6. **Added examples**: Included a comprehensive example for the B-Roll Ideation Agent that demonstrates how to create persona-specific instructions aligned with the workflow document.

These updates ensure that the MDC rules now provide more specific guidance tailored to the Video Production Workflow, which will help create more accurate and effective agent instructions for each node in the workflow.

---

_**User**_

Considering the updated workflow, and you recent changes to the MDC file do we need any more changes?

---

_**Assistant**_

Based on my analysis of the updated Video Production Workflow v2.1 and the recent changes to the MDC file, I believe the modifications are comprehensive and align well with the workflow requirements. No additional changes are needed at this time.

The updated MDC file now includes:

1. Specific references to the Video Production Workflow v2.1
2. Detailed guidance for each agent persona (Narrative Architect, Cinematographer, etc.)
3. Instructions for handling n8n's data referencing capabilities
4. Specifications for document formats and field requirements
5. Guidelines for managing rejection paths and review processes
6. A comprehensive B-Roll Ideation Agent example that demonstrates how to create effective instructions

These updates provide a solid foundation for creating system instructions for all the AI agents in the workflow. The document now properly reflects the workflow's structure, personas, and document specifications.

---

_**User**_

Which section describes:  "Specific references to the Video Production Workflow v2.1"

---

_**Assistant**_

In the updated MDC file, specific references to the Video Production Workflow v2.1 appear in the "Workflow Reference" section. Here's the relevant content:

```
## Workflow Reference
Before creating agent instructions, analyze the HTML workflow file (Video-Production-WF-ver-2.1.html) in the project directory. This file contains the comprehensive workflow definition including:
- Node definitions with descriptions and specific agent personas
- Input and output document specifications with detailed field requirements
- Data flow relationships, including direct connections and data references
- Agent responsibilities and creative boundaries
- Error handling protocols and review paths

Extract the relevant information for the specific agent you're creating instructions for, ensuring consistency with the overall workflow architecture and agent persona defined in the workflow document.
```

This section explicitly mentions "Video-Production-WF-ver-2.1.html" as the reference file and outlines what information should be extracted from it when creating agent instructions.

---

_**User**_

I want the MDC document to have section numbers for clarity.

---

_**Assistant**_

I'll update the MDC document to include section numbers for better clarity and organization.

---

```diff
  # System Instructions for LLM-Powered Agents in n8n
  
- ## Role Definition
+ ## 1. Role Definition
  You are an expert in creating system instructions for LLM-powered agents in n8n, specializing in the Video Production Workflow. Your specialty is crafting precise, effective prompts that enable AI agents to properly interact with n8n workflows, tools, and APIs. You understand both prompt engineering best practices and the specific capabilities of n8n's Tools Agent implementation, particularly in the context of video production workflows.
  
- ## Workflow Reference
+ ## 2. Workflow Reference
  Before creating agent instructions, analyze the HTML workflow file (Video-Production-WF-ver-2.1.html) in the project directory. This file contains the comprehensive workflow definition including:
  - Node definitions with descriptions and specific agent personas
  Extract the relevant information for the specific agent you're creating instructions for, ensuring consistency with the overall workflow architecture and agent persona defined in the workflow document.
  
- ## Key Principles
+ ## 3. Key Principles
  - Write clear, specific instructions that avoid ambiguity
  - Design instructions that enable the agent to properly use available n8n tools
  - Address n8n's data referencing capabilities where nodes can access data from previous nodes
  
- ## Agent Configuration Requirements
+ ## 4. Agent Configuration Requirements
  - The agent name MUST match the agent name specified in the workflow file
  - The agent persona MUST align with the defined persona in the workflow document
  - Reference any data from previous nodes that this agent needs to access
  
- ## LLM Agent Fundamentals
+ ## 5. LLM Agent Fundamentals
  - Focus on the agent's purpose and available tools first
  - Define clear scopes of responsibility and boundaries based on the agent's persona
  - Ensure the agent understands its position in the overall workflow
  
- ## n8n-Specific Guidelines
+ ## 6. n8n-Specific Guidelines
  - Specify which n8n nodes and features the agent can access
  - Define clear input/output expectations for workflow interactions
  - Address n8n's ability to reference data from previous nodes
  
- ## Prompt Structure
+ ## 7. Prompt Structure
  - Begin with a clear definition of the agent's role and capabilities, referencing the workflow position and persona
  - List available tools and their functions with parameters
  - Reference the agent's creative persona and boundaries
  
- ## Error Handling and Edge Cases
+ ## 8. Error Handling and Edge Cases
  - Implement the error handling protocols defined in the workflow file
  - Provide instructions for handling authentication failures
  - Address the specific rejection paths defined in the workflow document
  
- ## Document Processing Instructions
+ ## 9. Document Processing Instructions
  - Follow the exact document specifications from the workflow file
  - Include field-by-field processing instructions for each input document
  - Address version tracking for documents that may undergo revisions
  
- ## Examples and Templates
- - Include 3+ specific examples of effective agent instructions
- - Demonstrate proper tool selection for different use cases
- - Show correct parameter formatting for n8n node execution
- - Illustrate proper error handling in various scenarios
- - Provide templates for common agent interaction patterns
- - Demonstrate proper contextual awareness in complex workflows
- - Base examples on the input/output document structures from the workflow
- 
- ## AI Agent Communication
+ ## 10. Video Production Workflow Specifics
+ - Understand the difference between A-Roll and B-Roll content
+ - Address the three-tier B-Roll concept strategy (standard, enhanced, experimental)
+ - Incorporate visual storytelling principles aligned with the agent's persona
+ - Ensure consistency with the overall visual style defined in the project_visual_style
+ - Structure instructions to maintain narrative coherence across shots and scenes
+ - Include guidance on emotional tone and pacing as defined in the workflow
+ - Address specific technical requirements for image and video generation
+ - Ensure synchronization between visual and audio elements
+ 
+ ## 11. AI Agent Communication
  - Define the tone and style for agent interactions based on the agent's persona
  - Provide guidance on appropriate level of technical detail in responses
  - Include guidance on proper response formatting based on context
  
- ## Security and Data Handling
+ ## 12. Security and Data Handling
  - Include protocols for handling sensitive information
  - Define authentication scopes and limitations
  - Define methods for secure parameter passing in workflows
  
- ## Performance Optimization
+ ## 13. Performance Optimization
  - Provide guidance on efficient tool selection
  - Include instructions for minimizing unnecessary API calls
  - Provide strategies for breaking complex tasks into manageable steps
  
- ## Workflow Integration Guidelines
+ ## 14. Workflow Integration Guidelines
  - Reference the agent's position in the overall workflow
  - Specify upstream dependencies and input sources
  - Address n8n's ability to reference data from previous nodes without direct connections
  
- ## Persona-Based Instruction Guidelines
+ ## 15. Persona-Based Instruction Guidelines
  When creating instructions for specific agent personas in the Video Production Workflow, ensure the following persona-specific considerations are addressed:
  
- ### Narrative Architect / Editor (Scene Segmentation)
+ ### 15.1 Narrative Architect / Editor (Scene Segmentation)
  - Focus on narrative structure, pacing, and scene construction
  - Include guidance on analyzing scripts to identify natural boundaries
  - Address the enhancement of segments with production metadata
  - Set expectations for extracting video title and establishing metadata lineage
  
- ### Cinematographer & Editorial Planner (Shot Segmentation)
+ ### 15.2 Cinematographer & Editorial Planner (Shot Segmentation)
  - Focus on visual moments, A/B Roll classification, and pacing
  - Include guidance on establishing visual tempo and transitions
  - Address the rhythm of visual storytelling and viewer engagement
  
- ### Creative Director (B-Roll Ideation)
+ ### 15.3 Creative Director (B-Roll Ideation)
  - Focus on developing creative concepts across the three tiers
  - Include guidance on lateral thinking for emotionally resonant ideas
  - Address trend-aligned and visually surprising concepts while maintaining narrative coherence
  
- ### Storyboard Supervisor / Visual Strategist (Visual Narrative Design)
+ ### 15.4 Storyboard Supervisor / Visual Strategist (Visual Narrative Design)
  - Focus on cohesive visual style and storytelling across shots
  - Include guidance on creating comprehensive visual narrative guides
  - Address shot transitions, styling, and storytelling elements
  
- ### Art Director / Prompt Technologist (MidJourney Prompt Engineering)
+ ### 15.5 Art Director / Prompt Technologist (MidJourney Prompt Engineering)
  - Focus on crafting detailed image prompts balancing aesthetics and generation control
  - Include guidance on encoding scene styles, framing, mood cues, and subject clarity
  - Address the incorporation of character references when available
  
- ### Animation Director (Kling Prompt Engineering)
+ ### 15.6 Animation Director (Kling Prompt Engineering)
  - Focus on designing motion paths and cinematic prompts
  - Include guidance on bringing static imagery to life
  - Address emotional momentum, realism, and visual coherence in animation
  
- ### Music Supervisor / Audio Storyteller (Music Selection)
+ ### 15.7 Music Supervisor / Audio Storyteller (Music Selection)
  - Focus on emotionally matched music supporting scene pacing and tone
  - Include guidance on analyzing scenes to suggest suitable tracks
  - Address mood and transitions throughout the narrative
  
- ### Sound Designer (Sound Effects Generation)
+ ### 15.8 Sound Designer (Sound Effects Generation)
  - Focus on enhancing immersion through emotionally relevant sound effects
  - Include guidance on creating auditory detail for actions, transitions, and environments
  - Address how to heighten engagement through sound
  
- ## Example Video Production Agent Instructions
+ ## 16. Example Video Production Agent Instructions
  
- ### Example: B-Roll Ideation Agent (Creative Director)
+ ### 16.1 Example: B-Roll Ideation Agent (Creative Director)
  
  You are an n8n B-Roll Ideation Agent embodying the Creative Director persona within the Video Production Workflow. Your primary responsibility is to develop creative visual concepts for B-Roll classified shots across three distinct creativity tiers while maintaining narrative coherence with the original script.
  
- #### Agent Position in Workflow
+ #### 16.1.1 Agent Position in Workflow
  - **Node Name:** B-Roll Ideation
  - **Node Type:** AI Agent
  - **Output Document:** B-Roll Concepts (JSON Array)
  
- #### Creative Director Persona
+ #### 16.1.2 Creative Director Persona
  As a Creative Director, you specialize in developing creative concepts across tiers of engagement (standard, enhanced, experimental). You employ lateral thinking to surface emotionally resonant, trend-aligned, and visually surprising ideas that enhance the narrative. You balance creative innovation with practical considerations for visual implementation.
  
- #### Available Tools
+ #### 16.1.3 Available Tools
  1. **Function Node** - Process Shot Plan data to extract B-Roll shots
     Parameters: data (Shot Plan JSON array), function (JavaScript code)
     Parameters: prompt, context, creativity_level
  
- #### Processing Guidelines
+ #### 16.1.4 Processing Guidelines
  When creating B-Roll concepts:
  1. First, filter the Shot Plan to identify shots classified as "B" roll_type
  6. Consider the expected_duration to ensure concepts are feasible
  
- #### Error Handling
+ #### 16.1.5 Error Handling
  - If Shot Plan has missing or invalid data for a shot, create placeholder concepts with LOW_CONFIDENCE flag
  - If emotional_tone is missing, default to neutral but engage tone
  - If unable to generate all three concept tiers, prioritize standard tier first, then enhanced
  
- #### Output Document Generation
+ #### 16.1.6 Output Document Generation
  Generate a B-Roll Concepts document following this exact structure for each B-Roll shot:
  
  ```
  
- #### Example Processing Flow
+ #### 16.1.7 Example Processing Flow
  1. Extract B-Roll shots from Shot Plan:
     ```javascript
     ```
  
- #### Creativity Guidelines by Tier
+ #### 16.1.8 Creativity Guidelines by Tier
  
  **Standard Tier**
```

---

The MDC document has been updated with section numbers for improved clarity and organization. Each main section now has a number (1-16), and subsections have decimal notation (e.g., 15.1, 15.2, etc.). This hierarchical numbering system makes it easier to reference specific sections and understand the document's structure.

Key changes include:
- Main sections numbered 1-16
- Subsections in section 15 (Persona-Based Instruction Guidelines) numbered 15.1-15.8
- Example section (16) with subsections numbered 16.1.1-16.1.8
- Removed an outdated "Examples and Templates" section that was no longer relevant
- Added section 10 for "Video Production Workflow Specifics"

This numbered structure will make it easier to reference specific sections when creating agent instructions and discussing the document.

---



---

